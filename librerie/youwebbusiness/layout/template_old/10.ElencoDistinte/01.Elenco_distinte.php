<div class="main-content">
        <table class="main-content old-container">
            <tbody>
                <tr>
                    <td style="vertical-align: top;">
                        <div id="MainSection" style="visibility: visible;">
<div class="container"><div class="new-riquadro">
    <table cellpadding="0" cellspacing="0">
        <thead>
            <tr>
                <td colspan="2" class="page-title"><div class="search-flag"></div><h1>
                    Elenco Distinte
                </h1></td>
            </tr>
        </thead>
        <tbody>
            <tr style="height: 1px;">
                <td style="width: 66%;">
                    &nbsp;
                </td>
                <td style="width: 34%;">
                    &nbsp;
                </td>
            </tr>
            <!--filtri semplici generici-->
            <tr class="section">
                <td>
                    <table cellpadding="0" cellspacing="0" class="old-inputForm">
                        <tbody><tr>
                            <td class="LabelWrap" style="width: 26%;">
                                <span class="alert-text">*&nbsp;</span>Rag. Soc./ Intestatario:
                            </td>
                            <td class="Valore200" style="width: 66%;">
                                <select id="selectAzienda" style="width: 350px" class="new-form-control azienda"><option value="">TUTTI</option><option value="12">CONSORZIO P.R.U. STADIO CONEGL</option><option value="318683">GE.CO.VE. IMMOBILIARE S.R.L.</option><option value="10">GE.CO.VE. SRL</option><option value="9">GESCO S.R.L.</option><option value="633660">PIEVE S.R.L.</option><option value="8">QUERCIA SRL</option><option value="514369">SAN FERMO 12 S.R.L.</option><option value="13">SAR.MAR. SPA</option><option value="49308">SARTI ANTONIO</option></select>
                            </td>
                            <td style="width: 8%;">&nbsp;</td>
                        </tr>
                        <tr>
                            <td class="LabelWrap">
                                <span class="alert-text">*&nbsp;</span>Banca:
                            </td>
                            <td class="Valore200">
                                <select id="selectRapporti" style="width: 350px" class="new-form-control banca"><option value="">TUTTI</option><option value="{&quot;Id&quot;:1311,&quot;ABI&quot;:&quot;05024&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCA AGRICOLA MANTOVANA S.P.A.&quot;}">05024 - BANCA AGRICOLA MANTOVANA S.P.A.</option><option value="{&quot;Id&quot;:1313,&quot;ABI&quot;:&quot;05040&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCA ANTONVENETA&quot;}">05040 - BANCA ANTONVENETA</option><option value="{&quot;Id&quot;:1207,&quot;ABI&quot;:&quot;01030&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCA MONTE DEI PASCHI DI SIENA S.P.A.&quot;}">01030 - BANCA MONTE DEI PASCHI DI SIENA S.P.A.</option><option value="{&quot;Id&quot;:1102,&quot;ABI&quot;:&quot;01005&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCA NAZIONALE DEL LAVORO SPA&quot;}">01005 - BANCA NAZIONALE DEL LAVORO SPA</option><option value="{&quot;Id&quot;:1325,&quot;ABI&quot;:&quot;05188&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCA POPOLARE DI VERONA - S. GEMINIANO E S. PROSPERO S.P.A.&quot;}">05188 - BANCA POPOLARE DI VERONA - S. GEMINIANO E S. PROSPERO S.P.A.</option><option value="{&quot;Id&quot;:3422,&quot;ABI&quot;:&quot;05034&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCO BPM S.P.A.&quot;}">05034 - BANCO BPM S.P.A.</option><option value="{&quot;Id&quot;:1291,&quot;ABI&quot;:&quot;03500&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BANCO DI BRESCIA S.P.A.&quot;}">03500 - BANCO DI BRESCIA S.P.A.</option><option value="{&quot;Id&quot;:1341,&quot;ABI&quot;:&quot;05387&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;BPER BANCA S.P.A.&quot;}">05387 - BPER BANCA S.P.A.</option><option value="{&quot;Id&quot;:1422,&quot;ABI&quot;:&quot;06225&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;CASSA DI RISPARMIO DEL VENETO&quot;}">06225 - CASSA DI RISPARMIO DEL VENETO</option><option value="{&quot;Id&quot;:2028,&quot;ABI&quot;:&quot;03069&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;INTESA SANPAOLO SPA&quot;}">03069 - INTESA SANPAOLO SPA</option><option value="{&quot;Id&quot;:1212,&quot;ABI&quot;:&quot;03002&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;UNICREDIT BANCA DI ROMA SPA&quot;}">03002 - UNICREDIT BANCA DI ROMA SPA</option><option value="{&quot;Id&quot;:1209,&quot;ABI&quot;:&quot;02008&quot;,&quot;CAB&quot;:null,&quot;Descrizione&quot;:&quot;UNICREDIT SPA&quot;}">02008 - UNICREDIT SPA</option></select>
                            </td>
                        </tr>
                    </tbody></table>
                </td>
                <td>
                    <table cellpadding="0" cellspacing="0" class="old-inputForm">
                        <tbody><tr>
                            <td class="LabelWrap" style="width: 39%">
                                <label for="SIA">SIA</label>:
                            </td>
                            <td class="Valore100" style="width: 60%">
                                <input id="inputCodiceSia" type="text" value="" readonly="readonly" disabled="" class="new-form-control">
                            </td>
                            <td style="width: 1%">
                                &nbsp;
                            </td>
                        </tr>
                        <tr>
                            <td class="LabelWrap">
                                Righe per pagina:
                            </td>
                            <td class="Valore100">
                                <select id="numeroRighePagina" class="new-form-control"><option value="10" selected="selected">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select>
                            </td>
                            <td>
                                &nbsp;
                            </td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
            <tr class="section">
                <td>
                    <table cellpadding="0" cellspacing="0" class="old-inputForm">
                        <tbody><tr>
                            <td class="LabelWrap" style="width: 26%;">
                                <span class="alert-text">*&nbsp;</span>Tipo dispositivo:
                            </td>
                            <td class="Valore200" style="width: 66%;">
                                <select id="selectTipologiaDispositiva" style="width: 350px" class="new-form-control"><option value="">TUTTI</option><option value="0">Allineamento Archivi IBAN</option><option value="1">Assegni Circolari</option><option value="2">Assegni di Quietanza</option><option value="3">Bollettino Bancario</option><option value="4">Bollettino Postale</option><option value="5">Bonifici Italia</option><option value="6">Bonifico Singolo (Istantaneo)</option><option value="7">Bonifico Singolo (Ordinario-Urgente)</option><option value="8">Bonifici SEPA</option><option value="9">Effetti Impagati</option><option value="10">Incassi Direct Debit</option><option value="11">M.Av</option><option value="12">Pagamento Deleghe F24</option><option value="13">Pagamento F24 Elementi Identificativi</option><option value="14">R.I.D</option><option value="15">Revoche F24</option><option value="16">Ri.Ba.</option><option value="17">Ricarica Telefonica</option><option value="18">Richiamo M.Av</option><option value="19">Richiamo R.I.D</option><option value="20">Richiamo Ri.Ba.</option><option value="21">Richiesta rendiconto mandati SEDA</option><option value="22">Ritiro Effetti (Pagamento Riba)</option><option value="23">Stipendi Italia</option><option value="24">Stipendi SEPA</option><option value="25">Strutture Libere</option><option value="26">Variazioni Coordinate RID</option></select>
                            </td>
                            <td style="width: 8%;">&nbsp;</td>
                        </tr>
                        <tr>
                            <td class="LabelWrap">
                                <span class="alert-text">*&nbsp;</span>Stato:
                            </td>
                            <td class="Valore200">
                                <select id="selectStatoDistinta" style="width: 350px" class="new-form-control"><option value="">TUTTI</option><option value="1">Da autorizzare</option><option value="2">Autorizzata</option><option value="3">Confermata</option><option value="5">Parzialmente autorizzata</option><option value="6">In modifica</option></select>
                            </td>
                        </tr>
                    </tbody></table>
                </td>
                <td></td>
            </tr>
            <tr class="section">
                <td>&nbsp;</td>
                <td>
                    <table cellpadding="0" cellspacing="0" class="old-inputForm">
                        <tbody><tr>
                            <td class="Label" style="width: 60%">
                                <input id="ank-btn-FiltriAvanzati" type="button" value="<< Avanzate" class="btn small">
                            </td>
                            <td style="width: 40%;"></td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
            <tr style="height: 1pt;"><td colspan="2"></td></tr>

            <!--  FILTRI AVANZATI -->
            <tr id="FiltriAvanzati" style="border: 0px; display: table-row;" class="section">
                <td>
                    <table cellpadding="0" cellspacing="0">
                        <tbody><tr class="section">
                            <td colspan="3">
                                <table cellpadding="0" cellspacing="0" class="old-inputForm">
                                    <tbody><tr>
                                        <td style="width: 26%">
                                            &nbsp;
                                        </td>
                                        <td class="LabelOnLeft" style="width: 25%">
                                            Da:
                                        </td>
                                        <td style="width: 16%">
                                            &nbsp;
                                        </td>
                                        <td class="LabelOnLeft" style="width: 25%">
                                            A:
                                        </td>
                                        <td style="width: 8%">
                                            &nbsp;
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="LabelWrap" style="width: 26%;">
                                            Importo:
                                        </td>
                                        <td class="Valore200" style="width: 25%;">
                                            <input id="importoFrom" class="new-form-control" type="text" onkeypress="return sdk.utils.text.onlyRealNumbersChars(event);">
                                        </td>
                                        <td style="width: 16%;">
                                            &nbsp;
                                        </td>
                                        <td class="Valore200" style="width: 25%;">
                                            <input id="importoTo" class="new-form-control" type="text" onkeypress="return sdk.utils.text.onlyRealNumbersChars(event);">
                                        </td>
                                        <td style="width: 8%;">
                                            &nbsp;
                                        </td>
                                    </tr>
                                </tbody></table>
                            </td>
                        </tr>
                        <tr class="section">
                            <td>
                                <table cellpadding="0" cellspacing="0" class="old-inputForm">
                                    <tbody><tr>
                                        <td class="LabelWrap" style="width: 26%">
                                            Data creazione:
                                        </td>
                                        <td class="Valore200" style="width: 25%;">
                                            <input type="text" id="dataFrom" value="" class="hasDatepicker new-form-control">
                                            <img style="position:relative;top:3px;
                                                cursor:pointer;" id="imgcalendarDataFrom" src="/anchise.web/Contents/00000/it-IT/alten-anchise-images/calendar.png" alt="Apri calendario" title="Apri calendario" border="0" height="20" width="20">
                                        </td>
                                        <td style="width:16%; text-align:right;"></td>

                                        <td class="Valore200" style="width: 25%;">
                                            <input type="text" id="dataTo" value="" class="hasDatepicker new-form-control">
                                            <img style="position:relative;top:3px;
                                                cursor:pointer;" id="imgcalendarDataTo" src="/anchise.web/Contents/00000/it-IT/alten-anchise-images/calendar.png" alt="Apri calendario" title="Apri calendario" border="0" height="20" width="20">
                                        </td>
                                        <td style="width: 8%">
                                            &nbsp;
                                        </td>
                                    </tr>
                                </tbody></table>
                            </td>
                        </tr>
                    </tbody></table>
                </td>
                <td>
                    <table cellpadding="0" cellspacing="0" class="old-inputForm">
                        <tbody><tr><td colspan="3">&nbsp;</td></tr>
                        <tr><td colspan="3">&nbsp;</td></tr>
                        <tr>
                            <td class="LabelWrap" style="width: 39%">
                                <span class="alert-text">*&nbsp;</span>Effettua il check:

                            </td>
                            <td class="tdleftWrap" style="width: 60%">
                                <input type="checkbox" id="CheckValidita" name="CheckValidita" data-fullpropertyname="" data-bind="">
                            </td>
                            <td style="width: 1%">
                                &nbsp;
                            </td>
                        </tr>
                    </tbody></table>
                </td>
            </tr>
            <tr id="FiltriAvanzati1" style="height: 1pt; display: table-row;" class="section"><td colspan="2"></td></tr>
            <tr style="height: 12px;">
                <td colspan="2" class="testoRedSmallBold">
                    * campi obbligatori
                </td>
            </tr>
            <tr>
                <td class="Comandi" colspan="2">
                    
                </td>
                
            </tr>

        </tbody>
    </table>
</div><div class="new-buttons"><input id="ank-btn-search" type="button" value="Visualizza" class="btn"></div></div>




<script type="text/javascript">

    var baseUrl = "http://localhost:8009/Anchise2.Web/";

    var responseTipologie;

    //PER DEBUG LOCALE
    //var entryPointComboTipologie = 'http://localhost/Anchise2.Web/Sommario/SommarioBridge/GetTipologieDispo';

    var entryPointComboTipologie = '/Anchise2.Web/Sommario/SommarioBridge/GetTipologieDispo';

    function groupBy(objArray, property) {
        return objArray.reduce(function (acc, obj) {
            var key = obj[property];
            if (!acc[key]) {
                acc[key] = [];
            }
            acc[key].push(obj);
            return acc;
        }, {});
    };
    function getTipologie(success) {

        sdk.net.json(entryPointComboTipologie, null,
            {
                successHandler: function (caller, data, jsonResponse, warningObject) {
                    var newArrayTipologie = [];
                    jsonResponse.Response.forEach(function (item, index) {
                        var IdGroupType = item.IdGroupType;
                        if (dictionaryIdFuncClasseServizio[IdGroupType] !== undefined) {

                            item.classiServizioItec = dictionaryIdFuncClasseServizio[IdGroupType].clItec;
                            item.classiServizioAnchise = dictionaryIdFuncClasseServizio[IdGroupType].clAnc;
                            item.descIt = dictionaryIdFuncClasseServizio[IdGroupType].descIt;
                            item.ordineInElenco = dictionaryIdFuncClasseServizio[IdGroupType].ordineInElenco;

                            newArrayTipologie.push(item);
                        }
                    });
                    responseTipologie = newArrayTipologie;

                    if (success && typeof success === 'function') {
                        success();
                    };
                },
                errorHandler: function (response, jqXHR, textStatus, errorThrown, errorObject) {
                    sdk.utils.log.errorMessage("ERROR " + textStatus);
                }
            });
    }

    function goToUrl(entryPoint,filter) {
        sdk.net.loadTarget($('#MainSection'), entryPoint, filter);
    }

    function goToListaDistinte(parametri) {
        var filter = costruisciFilter('', parametri);
        var goToAnchise2 = (parametri.responseTipologie.IterType) ? true : false;
        var queryString = {
            numRows: filter.NumeroRighePerPagina,
            max_items_number: filter.NumeroRighePerPagina,
            first_item_count: '1',
            filtroVisibilita: true,
            STATO: filter.IdStatoDistinta || '*',
            intestatario: filter.PiazzaturaRicercaDistinta.IdAzienda,
            sia: parametri.inputCodiceSia || '*',
            banca: filter.LegacyIdBanca,
            abi: filter.PiazzaturaRicercaDistinta.ABIBanca,
            rapporto: '',
            TIPO: parametri.tipologiaSelezionata,
            DA_IMPORTO: filter.Importo.From,
            A_IMPORTO: filter.Importo.To,
            DA_DATA_CREAZIONE: filter.DataCreazione.From,
            A_DATA_CREAZIONE: filter.DataCreazione.To
        };

        if (goToAnchise2) {

            $.post('/anchise.web/Sommario/SommarioA2/SetCookie' + '?'
                + $.param(queryString, true)).success(function (data) {
                    window.top.location.href = parametri.responseTipologie.Url;
                });
        }
        else {
            var formLegacy = $('<form></form>')
                .attr('id', 'formLegacy')
                .attr('method', 'POST');
            $(document.body).append(formLegacy);
            var href = parametri.responseTipologie.Url + '?' + $.param(queryString, true);
            formLegacy.empty();
            var legacyParameters;
            //var params = $.parseJSON(legacyParameters);
            var params;
            if (params != null) {
                $.each( params, function( pkey, pvalue ) {
                    var inputHidden = $('<input>').attr({ type: 'hidden', name: pkey, value: pvalue });
                    formLegacy.append(inputHidden);
                });
            }

            formLegacy.attr("action", href);
            formLegacy.submit();
        }
    }

    function costruisciFilter(filter, parametri) {
        if (typeof filter !== 'object') {
            var filter = new Object();
        }
        //imposto i filtri da passare alle liste o alla sommario
        filter.PiazzaturaRicercaDistinta = {
            IdAzienda: parametri.aziendaSelezionata,
            ABIBanca: parametri.rapportoSelezionato
        };
        filter.DataCreazione = {
            From: parametri.dataFrom,
            To: parametri.dataTo
        };
        filter.Importo = {
            From: parametri.importoFrom,
            To: parametri.importoTo
        };
        filter.NumeroRighePerPagina = parametri.numeroRighePagina;
        filter.IdStatoDistinta = parametri.statoSelezionato;
        filter.IdTipoDispositivo = parametri.responseTipologie.classiServizioAnchise;
        filter.LegacyIdBanca = parametri.idBanca;

        return filter;
    }

    function rigaAzienda(table, azienda, bTotDistinte, idAzienda) {
        var idTrAzienda = 'tr_az_' + idAzienda;
        var rigaAzienda = $('#' + idTrAzienda);

        if (rigaAzienda.length == 0) {

            var tr = $('<tr></tr>')
                .addClass('subtitle bg-green-light')
                .attr('id', idTrAzienda);

            var td = $('<td></td>')
                .addClass('tdleftWrap bg-green-light')
                .css('border-bottom', '2px solid rgb(255, 255, 255)')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .attr('colspan', '6')
                .attr("id", "div_" + idAzienda);
            var h3 = $('<h3></h3>').addClass('new-titleSection');
            h3.text(azienda);
            td.append(h3);
            tr.append(td);

            var tdTotale = $('<td></td>')
                .addClass('tdrightWrap bg-green-light')
                .css('border-bottom', '2px solid rgb(255, 255, 255)');
            tdTotale.append(bTotDistinte);

            tr.append(tdTotale);
            table.append(tr);
        }
    }

    function rigaTipoDispositivo(table, helpUrlModifica, idAzienda) {
        var idTrTipoDispositivo = 'tr_tp_' + idAzienda;
        var rigaTipoDispositivo = $('#' + idTrTipoDispositivo);
        if (rigaTipoDispositivo.length == 0) {

            var tr = $('<tr></tr>')
                .addClass('subtitle')
                .attr('id', idTrTipoDispositivo);

            var td = $('<td></td>')
                .addClass('tdleftWrapBold')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('Tipo Dispositivo');
            tr.append(td);

            td = $('<td></td>')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('In modifica ');

            var span = $('<span></span>')
                    .click(function () { window.open(helpUrlModifica, "Dettaglio", "toolbar=no,scrollbars=yes,status=no,width=534,height=340"); });

            var img = $('<img />')
                .attr('src', '/anchise.web/Contents/00000/it-IT/Images/help.gif?v=75')
                .css({
                    'border': '0',
                    'width': '13px',
                    'height': '13px',
                    'cursor': 'pointer'
                });

            span.append(img);
            td.append(span);

            tr.append(td);

            td = $('<td></td>')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('Da autorizzare');
            tr.append(td);

            td = $('<td></td>')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('Parzialmente autorizzata');
            tr.append(td);

            td = $('<td></td>')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('Autorizzata');
            tr.append(td);

            td = $('<td></td>')
                .css('border-right', '1px solid rgb(255, 255, 255)')
                .text('Confermata');
            tr.append(td);

            td = $('<td></td>')
                .text('N. Distinte');
            tr.append(td);
            table.append(tr);
        }
    }

    var drawColumn = function (className, styleKey, styleValue, content) {

        var td = $('<td></td>')
            .addClass(className)
            .css(styleKey, styleValue);
        td.append(content);

        return td;
    };

    var drawColumnStatoDistinta = function (className, styleKey, styleValue, riga, tipologia, currentIdAzienda, tr,filtri) {
        var span;
        var tot = 0;

        if (typeof riga !== 'undefined') {

            riga.forEach(function (item, index) {

                tot += item.TotaleDistinte;
            });

            //tot = riga[0].TotaleDistinte;
            span = $('<span></span>').addClass('link').text(tot);

            span.click(function () {
                clickAction(tipologia, riga[0].StatoDistinta, currentIdAzienda,filtri);
            });

        }
        else {
            span = '';
            //tot = 0;
        }

        var td = $('<td></td>')
            .addClass(className)
            .css(styleKey, styleValue);

        td.append(span);
        tr.append(td);

        return tot;
    };

    function rigaTipologia(indiceOrdinamento, itemx, style, objTotali, filtri) {

        var currentIdAzienda = itemx[0][0].idAzienda;
        var totaloneDistinte = 0;

        var tr = $('<tr></tr>')
            .addClass('alternacolor')
            .addClass('idAzienda' + currentIdAzienda)
            .attr("id", indiceOrdinamento + "_tr_" + currentIdAzienda);

        var span;
        span = $('<span></span>').addClass('linknounder').text(itemx[0].tipologia.descIt);

        span.click(function () {
            clickAction(itemx[0].tipologia, '', currentIdAzienda, filtri)
        });
        tr.append(drawColumn('tdleftWrapBold', 'border-right', style, span));

        //parte da 1 altrimenti aggiunge se stesso che ha indice zero
        for (var i = 1; i < itemx.length; i++) {
            for (var y = 0; y < itemx[i].length; y++) {
                itemx[0].push(itemx[i][y]);
            }
        }

        var groupByStatoDistinta = groupBy(itemx[0], 'StatoDistinta');
        //in modifica 6
        objTotali.totaloneDistinte += drawColumnStatoDistinta('tdright', 'border-right', style, groupByStatoDistinta[6], itemx[0].tipologia, currentIdAzienda, tr,filtri);

        //da autorizzare 1
        objTotali.totaloneDistinte += drawColumnStatoDistinta('tdright', 'border-right', style, groupByStatoDistinta[1], itemx[0].tipologia, currentIdAzienda, tr,filtri);

        //parzialmente autorizzata 5
        objTotali.totaloneDistinte += drawColumnStatoDistinta('tdright', 'border-right', style, groupByStatoDistinta[5], itemx[0].tipologia, currentIdAzienda, tr,filtri);

        //autorizzata 2
        objTotali.totaloneDistinte += drawColumnStatoDistinta('tdright', 'border-right', style, groupByStatoDistinta[2], itemx[0].tipologia, currentIdAzienda, tr,filtri);

        //confermata 3
        objTotali.totaloneDistinte += drawColumnStatoDistinta('tdright', 'border-right', style, groupByStatoDistinta[3], itemx[0].tipologia, currentIdAzienda, tr,filtri);

        objTotali.totaleDistintePerAzienda += objTotali.totaloneDistinte;

        //totale della riga
        span = $('<span></span>').addClass('link').text(objTotali.totaloneDistinte);
        span.click(function () {
            clickAction(itemx[0].tipologia, '', currentIdAzienda,filtri);
        });
        tr.append(drawColumn('tdright', '', null, span));

        objTotali.totaloneDistinte = 0;

        return tr;
    }

    function clickAction(tipologia, statoDistinta, currentIdAzienda, filtri) {
        var parametri = {
            aziendaSelezionata: currentIdAzienda,
            idBanca: filtri.LegacyIdBanca,
            rapportoSelezionato: filtri.PiazzaturaRicercaDistinta.ABIBanca,
            tipologiaSelezionata: (tipologia.IterType ? tipologia.classiServizioAnchise : tipologia.classiServizioItec),
            statoSelezionato: statoDistinta,
            numeroRighePagina: filtri.NumeroRighePerPagina,
            responseTipologie: tipologia,
            dataFrom: filtri.DataCreazione.From ? moment(filtri.DataCreazione.From, ["DD/MM/YYYY", "YYYY/MM/DDTHH:mm:ss"])._i : '',
            dataTo: filtri.DataCreazione.To ? moment(filtri.DataCreazione.To, ["DD/MM/YYYY", "YYYY/MM/DDTHH:mm:ss"])._i : '',
            importoFrom: filtri.Importo.From,
            importoTo: filtri.Importo.To
        };
        goToListaDistinte(parametri);
    };

    function formatDateFromServer(filter) {
        filter.DataCreazione.From = filter.DataCreazione.From ? moment(filter.DataCreazione.From).format("DD/MM/YYYY") : '';
        filter.DataCreazione.To = filter.DataCreazione.To ? moment(filter.DataCreazione.To).format("DD/MM/YYYY") : '';
    }

    function formatImportofromServer(filter) {
        //forzo a stringa per utilizzare il replace
        filter.Importo.From += '';
        filter.Importo.To += '';

        filter.Importo.From = filter.Importo.From.replace("." , ",");
        filter.Importo.To = filter.Importo.To.replace("." , ",");
    }



    var dictionaryIdFuncClasseServizio = {
    '8000': {
        clItec: 10,
        clAnc: 'AEA',
        idFunc: '1006130',
        ordineInElenco: 20,
        //descIt: 'Allineamento Archivi'
        descIt: 'Assegni Circolari'
    },
    '9000': {
        clItec: 11,
        clAnc: 'AEI',
        idFunc: '1006140',
        ordineInElenco: 4,
        //descIt: 'Allineamento Archivi IBAN'
        descIt: 'Allineamento Archivi IBAN'
    },
    '12000': {
        clItec: 42,
        clAnc: 'EIM',
        idFunc: '1004070,1004080',
        ordineInElenco: 6,
        //descIt: 'Effetti Impagati'
        descIt: 'Effetti Impagati'
    },
    '11000': {
        clItec: 28,
        clAnc: 'REF',
        idFunc: '1004070,1004080',
        ordineInElenco: 5,
        //descIt: 'Ritiro Effetti (Pagamento Riba)'
        descIt: 'Ritiro Effetti (Pagamento Riba)'
    },
    '31000': {
        clItec: 205,
        clAnc: 'IES',
        idFunc: '1002044',
        ordineInElenco: 18,
        //descIt: 'Incassi Estero'
        descIt: 'Incassi Estero'
    },
    '3000': {
        clItec: 4,
        clAnc: 'IMV',
        idFunc: '1006020',
        ordineInElenco: 2,
        //descIt: 'M.Av'
        descIt: 'M.Av'
    },
    '4000': {
        clItec: 5,
        clAnc: 'RMV',
        idFunc: '1006020',
        ordineInElenco: 19,
        //descIt: 'Richiamo M.Av'
        descIt: 'Richiamo M.Av'
    },
    '1000': {
        clItec: 2,
        clAnc: 'IRB',
        idFunc: '1006010',
        ordineInElenco: 1,
        //descIt: 'Ri.Ba.'
        descIt: 'Ri.Ba.'
    },
    '2000': {
        clItec: 3,
        clAnc: 'RRB',
        idFunc: '1006010',
        ordineInElenco: 21,
        //descIt: 'Richiamo Ri.Ba.'
        descIt: 'Richiamo Ri.Ba.'
    },
    '5000': {
        clItec: 6,
        clAnc: 'IRD',
        idFunc: '1006040',
        ordineInElenco: 3,
        //descIt: 'R.I.D'
        descIt: 'R.I.D'
    },
    '6000': {
        clItec: 7,
        clAnc: 'RRD',
        idFunc: '1006040',
        ordineInElenco: 22,
        //descIt: 'Richiamo R.I.D'
        descIt: 'Richiamo R.I.D'
    },
    '29000': {
        clItec: 201,
        clAnc: 'PAC',
        idFunc: '1004120',
        ordineInElenco: 16,
        //descIt: 'Assegni Circolari'
        descIt: 'Assegni Circolari'
    },
    '30000': {
        clItec: 202,
        clAnc: 'PAQ',
        idFunc: '1004130',
        ordineInElenco: 17,
        //descIt: 'Assegni di Quietanza'
        descIt: 'Assegni di Quietanza'
    },
    '15000': {
        clItec: 100,
        clAnc: 'PBB',
        idFunc: '1004140',
        ordineInElenco: 23,
        //descIt: 'Bollettino Bancario'
        descIt: 'Bollettino Bancario'
    },
    '17000': {
        clItec: 103,
        clAnc: 'PBE',
        idFunc: '1004050',
        ordineInElenco: 8,
        //descIt: 'Bonifico Estero'
        descIt: 'Bonifico Estero'
    },
    '13000': {
        clItec: 63,
        clAnc: 'PBO',
        idFunc: '1004020',
        ordineInElenco: 7,
        //descIt: 'Bonifici Italia'
        descIt: 'Bonifici Italia'
    },
    '18000': {
        clItec: 104,
        clAnc: 'PF4',
        idFunc: '1004090',
        ordineInElenco: 9,
        //descIt: 'Pagamento Deleghe F24'
        descIt: 'Pagamento Deleghe F24'
    },
    '19000': {
        clItec: 105,
        clAnc: 'RF4',
        idFunc: '1004090',
        ordineInElenco: 10,
        //descIt: 'Revoche F24'
        descIt: 'Revoche F24'
    },
    '20000': {
        clItec: 106,
        clAnc: 'PFI',
        idFunc: '1004100',
        ordineInElenco: 11,
        //descIt: 'Pagamento F24 Elementi Identificativi'
        descIt: 'Pagamento F24 Elementi Identificativi'
    },
    '28000': {
        clItec: 200,
        clAnc: 'PST',
        idFunc: '1004040',
        ordineInElenco: 15,
        //descIt: 'Stipendi Italia'
        descIt: 'Stipendi Italia'
    },
    '26000': {
        clItec: 174,
        clAnc: 'SAC',
        idFunc: '1006100',
        ordineInElenco: 14,
        //descIt: 'Allineamento SEDA'
        descIt: 'Allineamento SEDA'
    },
    '32000': {
        clItec: 206,
        clAnc: 'SLD',
        idFunc: '1002046',
        ordineInElenco: 24,
        //descIt: 'Strutture Libere'
        descIt: 'Strutture Libere'
    },
    '27000': {
        clItec: 175,
        clAnc: 'SRC',
        idFunc: '1006120',
        ordineInElenco: 25,
        //descIt: 'Richiesta rendiconto mandati SEDA'
        descIt: 'Richiesta rendiconto mandati SEDA'
    },
    '7000': {
        clItec: 8,
        clAnc: 'VRD',
        idFunc: '1006050',
        ordineInElenco: 26,
        //descIt: 'Variazioni Coordinate RID'
        descIt: 'Variazioni Coordinate RID'
    },
    '23000': {
        clItec: 151,
        clAnc: 'XBN,FBN',
        idFunc: '1004010,1004022',
        ordineInElenco: 12,
        //descIt: 'Bonifici SEPA'
        descIt: 'Bonifici SEPA'
    },
    '25000': {
        clItec: 171,
        clAnc: 'XDD',
        idFunc: '1006030',
        ordineInElenco: 13,
        //descIt: 'Incassi Direct Debit'
        descIt: 'Incassi Direct Debit'
    },
    '24000': {
        clItec: 152,
        clAnc: 'XST',
        idFunc: '1004030',
        ordineInElenco: 27,
        //descIt: 'Stipendi SEPA'
        descIt: 'Stipendi SEPA'
    },
    '33000': {
        clItec: 207,
        clAnc: 'IER',
        idFunc: '1006070',
        ordineInElenco: 28,
        //descIt: 'Elcos/Ribes'
        descIt: 'Elcos/Ribes'
    },
    '34000': {
        clItec: 208,
        clAnc: 'IEU',
        idFunc: '1006060',
        ordineInElenco: 29,
        //descIt: 'EuroIncassi'
        descIt: 'Euroincassi'
    },
    '35000': {
        clItec: 209,
        clAnc: 'MT1',
        idFunc: '1004060',
        ordineInElenco: 30,
        //descIt: 'MT101 Request for Transfer'
        descIt: 'MT101 Request for Transfer'
    },
    '22000': {
        clItec: 252,
        clAnc: 'IPA',
        idFunc: '1004023',
        ordineInElenco: 31,
        //descIt: 'Bonifico Instant Payments'
        descIt: 'Bonifico Singolo (Istantaneo)'
    },
    '23500': {
        clItec: 151,
        clAnc: 'VBN,OBN',
        idFunc: '1004021',
        ordineInElenco: 32,
        //descIt: 'Bonifico Singolo'
        descIt: 'Bonifico Singolo (Ordinario-Urgente)'
    },
    '37000': {
        clItec: 253,
        clAnc: 'RIT',
        idFunc: '1004180',
        ordineInElenco: 33,
        //descIt: 'Ricarica Telefonica'
        descIt: 'Ricarica Telefonica'
    },
    '36000': {
        clItec: 251,
        clAnc: 'BOP',
        idFunc: '1004150',
        ordineInElenco: 34,
        //descIt: 'Bollettino Postale'
        descIt: 'Bollettino Postale'
    }
};

</script>


<script type="text/javascript">
    
    var filter = {"PiazzaturaRicercaDistinta":{"IdAzienda":null,"ABIBanca":null,"IdRapporto":null},"IdTipoDispositivo":null,"Importo":{"From":null,"To":null},"DataCreazione":{"From":null,"To":null},"CheckValidita":0,"IdStatoDistinta":null,"ListaStatiDistinta":null,"IdDistinteDaDisaggregare":[],"IdDistinteDaCopiare":[],"IdDistinteDaEliminare":[],"IdDistinteDaFirmare":[],"IdAziendaSelected":0,"LegacyParameters":null,"LegacyCodiceSIA":null,"LegacyIdBanca":null,"LegacyFirst_item_count":null,"PaginaRichiesta":1,"NumeroRighePerPagina":10,"OrdinamentoColonna":1,"OrdinamentoDirezione":2};

    formatDateFromServer(filter);
    var listaStatiDistinta = [{"IdStato":1,"Descrizione":"Da autorizzare"},{"IdStato":2,"Descrizione":"Autorizzata"},{"IdStato":3,"Descrizione":"Confermata"},{"IdStato":5,"Descrizione":"Parzialmente autorizzata"},{"IdStato":6,"Descrizione":"In modifica"}];

    $(document).ready(function () {

        //$('#_json').click(function () {
        //    var url = 'http://localhost/Anchise.Web/DT/Dossier/RicercaJson/'; 
        //    //var url = 'http://localhost/Anchise.Web/DT/Dossier/InitializeByPiazzatura/';

        //    var parameter = {
        //        'parameter': {
        //            PiazzaturaRapportoDossier: { IdAzienda: 12, ABIBanca: '', IdRapporto: '' },
        //            numeroRighePerPagina: 10,
        //            PaginaRichiesta: 1,
        //            OrdinamentoColonna: 1,
        //            OrdinamentoDirezione: 'A'
        //        }
        //    };
            
        //    sdk.net.json(url, parameter,
        //        {
        //            successHandler: function (caller, data, jsonResponse, warningObject) {
        //                console.log(jsonResponse.Result);
        //            },
        //            errorHandler: function (response, jqXHR, textStatus, errorThrown, errorObject) {
        //                sdk.utils.log.errorMessage("ERROR " + textStatus);
        //            }

        //        });
        //})


        function popolaComboStatiDistinta() {
            $('#selectStatoDistinta').append($('<option></option>').val("")
                .html("TUTTI"));

            listaStatiDistinta.forEach(function (item, index) {
                var option = $('<option></option>').val(item.IdStato).text(item.Descrizione)
                if (item.IdStato == filter.IdStatoDistinta) {
                    option.attr('selected', 'selected')
                }
                $('#selectStatoDistinta').append(option);
            });

        }

        popolaComboStatiDistinta();

        getTipologie(function () {

            $('#selectTipologiaDispositiva').html('');
            $('#selectTipologiaDispositiva').append($('<option></option>').val("")
                .html("TUTTI"));

            responseTipologie.forEach(function (item, index) {

                //questa IF serve per togliere dalla combo eventuali tipologie che non sono state mappate nella variabile dictionaryIdFuncClasseServizio e togliere quindi la riba bianca.
                if (item.descIt !== undefined) {

                    var option = $('<option></option>').val(index).text(item.descIt);
                    if (item.classiServizioItec == filter.IdTipoDispositivo || item.classiServizioAnchise == filter.IdTipoDispositivo) {
                        option.attr('selected', 'selected')
                    }
                    $('#selectTipologiaDispositiva').append(option);

                }
            });
        });

        $('#ank-btn-search').click(function () {
            var entryPointSommario = '/anchise.web/Sommario/SommarioA2/Ricerca?trk=empty';
            
            if ($('#selectRapporti').val() != "") {
                var rapportoSelezionato = $.parseJSON($('#selectRapporti').val());
            } else {
                var rapportoSelezionato = "";
            }
            var parametri = {
                aziendaSelezionata: $('#selectAzienda').val(),
                idBanca: rapportoSelezionato ? rapportoSelezionato.Id : null,
                rapportoSelezionato: rapportoSelezionato ? rapportoSelezionato.ABI : null,
                tipologiaSelezionata : $('#selectTipologiaDispositiva').val(),
                dataFrom: $('#dataFrom').val() ? moment($('#dataFrom').val(), ["DD/MM/YYYY", "YYYY/MM/DDTHH:mm:ss"]).format("DD/MM/YYYY") : '',
                dataTo: $('#dataTo').val() ? moment($('#dataTo').val(), ["DD/MM/YYYY", "YYYY/MM/DDTHH:mm:ss"]).format("DD/MM/YYYY") : '',
                importoFrom : $('#importoFrom').val(),
                importoTo : $('#importoTo').val(),
                statoSelezionato : $('#selectStatoDistinta').val(),
                inputCodiceSia : $('#inputCodiceSia').val(),
                numeroRighePagina: $('#numeroRighePagina').val(),
                goToSummary: ($('#selectAzienda').val() == null || $('#selectAzienda').val() == '') || ($('#selectTipologiaDispositiva').val() == null || $('#selectTipologiaDispositiva').val() == ''),
                responseTipologie: ($('#selectTipologiaDispositiva').val() && responseTipologie[$('#selectTipologiaDispositiva').val()]
                    ? responseTipologie[$('#selectTipologiaDispositiva').val()] : '')
            }
            parametri.tipologiaSelezionata = (parametri.responseTipologie.IterType ? parametri.responseTipologie.classiServizioAnchise : parametri.responseTipologie.classiServizioItec);
            filter = costruisciFilter(filter, parametri);
            //se true vado alla sommario
            if (parametri.goToSummary) {

                goToUrl(entryPointSommario, filter);

            } else {

                goToListaDistinte(parametri);

            }
        });

        $.datepicker.regional['it'] = {
            closeText: 'Chiudi',
            prevText: '&#x3c;Prec',
            nextText: 'Succ&#x3e;',
            currentText: 'Oggi',
            monthNames: ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'],
            monthNamesShort: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'],
            dayNames: ['Domenica', 'Luned&#236', 'Marted&#236', 'Mercoled&#236', 'Gioved&#236', 'Venerd&#236', 'Sabato'],
            dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'],
            dayNamesMin: ['Do', 'Lu', 'Ma', 'Me', 'Gi', 'Ve', 'Sa'],
            dateFormat: 'dd/mm/yy',
            firstDay: 1,
            isRTL: false,
            maxDate: '+1Y'
        };

        $.datepicker.setDefaults($.datepicker.regional['it']);

        $("#dataFrom").datepicker({
            onSelect: function (dateText) {
                $("#dataFrom").datepicker('hide');


                if ($('#dialogpopup')) {
                    $('#dialogpopup').focus()
                }

                $(this).change();
            }
        });

        $("#imgcalendarDataFrom").click(function(){
            $("#dataFrom").datepicker('show');
        });

        $("#dataTo").datepicker({
            onSelect: function (dateText) {
                $("#dataTo").datepicker('hide');


                if ($('#dialogpopup')) {
                    $('#dialogpopup').focus()
                }

                $(this).change();
            }
        });

        $("#imgcalendarDataTo").click(function () {
            $("#dataTo").datepicker('show');
        });

        $("#ank-btn-FiltriAvanzati").click(function (e) {

            e.preventDefault();

            if ($("#FiltriAvanzati").is(":hidden")) {
                showFilter();
            } else {
                hideFilter();
            }
        }
        );
        if (filter.Importo.From || filter.Importo.To || filter.DataCreazione.From || filter.DataCreazione.To) {
            $('#importoFrom').val(filter.Importo.From);
            $('#importoTo').val(filter.Importo.To);

            if (filter.DataCreazione.From !== null) {
                $('#dataFrom').val(filter.DataCreazione.From);
            }
            if (filter.DataCreazione.To !== null) {
                $('#dataTo').val(filter.DataCreazione.To);
            }
            showFilter();
        } else {
            hideFilter();
        }

        function hideFilter() {
            $("#ank-btn-FiltriAvanzati").attr('value', ">> Avanzate");
            $("#FiltriAvanzati").hide();
            $("#FiltriAvanzati1").hide();
        };

        function showFilter() {
            $("#ank-btn-FiltriAvanzati").attr("value", "<< Avanzate");
            $("#FiltriAvanzati").show();
            $("#FiltriAvanzati1").show();
        };

        function popolaComboRagioneSociale(idAzienda, abiBanca) {
            var entryPointPiazzaturaLookupAction = '/anchise.web/Sommario/SommarioA2/InitializeByPiazzatura?trk=empty';
            var piazzatura = {
                    IdAzienda: idAzienda,
                    ABIBanca: abiBanca,
                    IdRapporto: null
                };
            
            sdk.net.json(entryPointPiazzaturaLookupAction,
                piazzatura,
                {
                    successHandler: function (caller, data, jsonResponse, warningObject) {
                        initializeFromPiazzatura(jsonResponse);
                    },
                    errorHandler: function (response, jqXHR, textStatus, errorThrown, errorObject) {
                        sdk.utils.log.errorMessage("ERRORE " + textStatus);
                    }
                });

        }
        var cmbAzienda = $('#selectAzienda');
        var cmbBanca = $('#selectRapporti');
        var inputSia = $('#inputCodiceSia');
        var cmbRighePagina = $('#numeroRighePagina');

        function initializeFromPiazzatura(piazzaturaRapporto) {
            unregisterChangeCombo();
            pulisciCampi();
            initializeComboBoxFromPiazzaturaRapporto(piazzaturaRapporto);
            registerChangeCombo();
        }

        function registerChangeCombo() {
            cmbAzienda.change(function () {
                var selectedAzienda = cmbAzienda.val();

            popolaComboRagioneSociale(selectedAzienda,"");
            });

            cmbBanca.change(function () {
                var selectedAzienda = cmbAzienda.val();
                var selectedBanca = $.parseJSON(cmbBanca.val()).ABI;

                popolaComboRagioneSociale(selectedAzienda,selectedBanca);
            });

            var elencoRighePerPagina = [10, 20, 50, 100];

            elencoRighePerPagina.forEach(function (righe) {
                var option = $('<option></option>').val(righe).text(righe);
                if (righe == filter.NumeroRighePerPagina){
                    option.attr('selected', 'selected');
                }
                cmbRighePagina.append(option);
            });
        }

        function pulisciCampi() {
            inputSia.val('');
        }

        function unregisterChangeCombo() {
            cmbAzienda.unbind('change');
            cmbBanca.unbind('change');
            cmbRighePagina.unbind('change');
        }

        function initializeComboBoxFromPiazzaturaRapporto(piazzaturaRapporto) {
                 var aziende = piazzaturaRapporto.Aziende;
                 var rapporti = piazzaturaRapporto.Rapporti;
                 var banche = piazzaturaRapporto.Banche;
                 var piazzatura = piazzaturaRapporto.Piazzatura;

                 // Combo azienda
                 cmbAzienda.empty();
                 if (aziende.length > 0) {
                     cmbAzienda
                         .append($('<option></option>')
                             .val("")
                             .html("TUTTI"));
                 }

                 var emptySIA = '';
                 var emptyIdBanca = '';

                 $.each(aziende, function (index, azienda) {
                     var option = $('<option></option>')
                         .val(azienda.IdAzienda)
                         .text(azienda.RagioneSociale);
                     cmbAzienda.append(option);
                     if (azienda.IdAzienda == piazzatura.IdAzienda) {
                         option.attr('selected', 'selected')
                         inputSia.val(azienda.CodiceSIA);
                     }
                 });

                 // bug ie7
                 cmbAzienda.removeClass("azienda").addClass("azienda");

                 // Combo banca
                 cmbBanca.empty();
                 if (banche.length > 0) {
                     cmbBanca
                         .append($('<option></option>')
                             .val("")
                             .html("TUTTI"));
                 }

                 $.each(banche, function (index, banca) {
                     var description = banca.ABI + " - " + banca.Descrizione;
                     var option = $('<option></option>')
                         .val(JSON.stringify(banca))
                         .text(description);
                     cmbBanca.append(option);

                     if (banca.ABI == piazzatura.ABIBanca) {
                         option.attr('selected', 'selected')
                    }
                 });
                 // bug ie7
                 cmbBanca.removeClass("banca").addClass("banca");
             }

        popolaComboRagioneSociale(filter.PiazzaturaRicercaDistinta.IdAzienda, filter.PiazzaturaRicercaDistinta.ABIBanca);

    });
</script></div>
                        <div id="mario">
    <script type="text/javascript">
        $(document).ready(function () {
            var filter = {"PiazzaturaRicercaDistinta":{"IdAzienda":null,"ABIBanca":null,"IdRapporto":null},"IdTipoDispositivo":null,"Importo":{"From":null,"To":null},"DataCreazione":{"From":null,"To":null},"CheckValidita":0,"IdStatoDistinta":null,"ListaStatiDistinta":null,"IdDistinteDaDisaggregare":[],"IdDistinteDaCopiare":[],"IdDistinteDaEliminare":[],"IdDistinteDaFirmare":[],"IdAziendaSelected":0,"LegacyParameters":null,"LegacyCodiceSIA":null,"LegacyIdBanca":null,"LegacyFirst_item_count":null,"PaginaRichiesta":0,"NumeroRighePerPagina":0,"OrdinamentoColonna":-1,"OrdinamentoDirezione":0};
            
            if (sessionStorage.getItem('fromWidget') === 'true') {
                
                var entryPointSommarioA2 = '/anchise.web/Sommario/SommarioA2/Ricerca?trk=empty';
                filter.ListaStatiDistinta = sessionStorage.getItem('listaStati');

                communicationLoad(entryPointSommarioA2, filter);
            } else {

                var entryPointFiltriDistinte = '/anchise.web/Sommario/SommarioA2/FiltriDistinte?trk=empty';
                communicationLoad(entryPointFiltriDistinte);
            }

            
            sessionStorage.removeItem("listaStati");
    });
    </script>
</div>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td style="vertical-align: bottom;">
                        


                    </td>
                </tr>
            </tfoot>
        </table>
    </div>