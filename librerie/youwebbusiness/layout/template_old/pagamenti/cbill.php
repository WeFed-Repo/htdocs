<div id="MainSection">


    <div id="2080bfee7dd0461e8a1c2fe9d2912e83_3">
        
        <div class="riquadro clearfix">
            
            <div class="pager clearfix pull-right">
                <div class="circle_line">&nbsp;</div>
                <div class="circle current_page">&nbsp;</div>
                <div class="circle ">&nbsp;</div>
                <div class="circle ">&nbsp;</div>
            </div>
            
            <div class="clearfix">
                <div class="flag cbiLL"><div id="Bill"></div>&nbsp;</div>
                <h1>CBILL - pagoPA: compilazione</h1>
                <a class="icon-replace icon-help active link" href="javascript:void(0);">Help On Line</a>
            </div>
            
            <div id="messagePanelAlert">
                
<div class="col-xs-12 messagePanel error visible" style="display: block; margin-bottom: 0;margin-top: 0;">
    <h3 class="titleSection">Attenzione</h3>
    <p>
        </p><ul>
                <li>
                    

<div>
Manca la descrizione del beneficiario    

</div>











                </li>
        </ul>
    <p></p>
</div>









            </div>

            <div class="homebox">
                <div class="section clearfix">
                    <h3 class="titleSection">Selezione Rapporti</h3>    
                                    
                    

<style>
    .redClassInternal {
        color: #ff0000;
    }
</style>




    <div id="2080bfee7dd0461e8a1c2fe9d2912e83_4">

        <div class="tabellaSelezioneCC">
            <div id="panelMessageRapporti" class="CCselezionato clearfix" style="min-height: 80px; padding-top: 30px; display: none;">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 msgInfo">
                    <span class="col-md-6"></span>
                    <a id="SelettoreRapportiIcon" href="#" class="btnSelezioneCC icon-replace icon-arrowdown hidden"></a>
                </div>

            </div>

            <div id="selezioneRapportoSingolo" class="CCselezionato clearfix" style="display: block;">
                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
                    <span class="col-md-3 ">Intestato a&nbsp;</span>
                    <span id="intestazione" class="col-md-8 intestazione">C.P.C. INOX SPA</span>
                    <span class="col-md-3 ">ABI - CAB&nbsp;</span>
                    <span id="agenzia" class="col-md-8 ABI">05034 - 33473</span>
                    <span class="col-md-3 ">Saldo contabile&nbsp;</span>
                    <span id="contabile" class="col-md-8 contabile">411.201,61 EUR</span>
                </div>

                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 ">
                    <span id="conto" class="col-md-3">Rapporto&nbsp;</span>
                    <span id="numero" class="col-md-8 numero">079200011905</span>
                    
                    <span class="col-md-3">IBAN&nbsp;</span>
                    <span id="iban" class="col-md-8 CAB">IT38V0503433473000000011905</span>

                    <span class="col-md-3">Saldo disponibile&nbsp;</span>
                    <span id="disponibile" class="col-md-8 disponibile">461.201,61 EUR</span>
                </div>
                <a id="SelettoreRapportiIconSelect" href="#" class="btnSelezioneCC icon-replace icon-arrowdown hidden"></a>
            </div>

            <div class="table-responsive tabSelezioneCC" style="display: none;">
                <!--tabSelezioneRapporto-->
                <div class="dataTables_wrapper">

                    <div id="itemSelectorTable_wrapper" class="dataTables_wrapper no-footer"><table id="itemSelectorTable" class="table table-striped dataTable no-footer" role="grid">
                        <tbody><tr tmindex="0" role="row" class="odd"><td class="hidden sorting_1" style="text-align: center"><input type="radio" name="codContoCorrente" value="001|0004|000400585163" checked="checked"></td><td> 079200011905 </td> <td>05034 </td> <td>33473 </td> <td>C.P.C. INOX SPA</td> <td class="oRight">411.201,61 €</td> <td class="oRight">461.201,61 €</td> <td class="oRight hidden">&nbsp;</td> </tr></tbody>
                        <thead>
                            <tr role="row"><th class="hidden sorting_asc" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-sort="ascending" aria-label="&amp;nbsp;: ordinamento decrescente" style="width: 0px;">&nbsp;</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="Rapporto: ordinamento crescente" style="width: 0px;">Rapporto</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="ABI: ordinamento crescente" style="width: 0px;">ABI</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="CAB: ordinamento crescente" style="width: 0px;">CAB</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="Instestazione: ordinamento crescente" style="width: 0px;">Instestazione</th><th class="hidden sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="Affidamento: ordinamento crescente" style="width: 0px;">Affidamento</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="Saldo Contab.: ordinamento crescente" style="width: 0px;">Saldo Contab.</th><th class="sorting" tabindex="0" aria-controls="itemSelectorTable" rowspan="1" colspan="1" aria-label="Saldo Disp.: ordinamento crescente" style="width: 0px;">Saldo Disp.</th></tr>
                        </thead>
                    </table></div>

                </div>
            </div>

        </div>
        


    </div>


                </div>

                <div class="section clearfix">
                    <h3 class="titleSection">Dati Bolletta</h3>
                    <div class="bs-example form-horizontal">
                        <div class="form-group">
                            <div class="form-field-input col-xs-4">
                                <div id="PagamentoBill"></div>                                                                
                                <label class="control-label" for="biller">
                                    Pagamento a favore di
                                    &nbsp;
                                    
                                </label>    
                                <div class="form-field">
                                    <input class="placeh form-control ui-autocomplete-input ui-menu" id="biller" type="text" size="30" placeholder="Inserisci il nome del beneficiario" autocomplete="off">
                                    <input name="codSia" id="codSia" type="hidden" value="[object HTMLInputElement]">
                                </div>
                                <label class="control-label" for="importo"> Importo </label>
                                <div class="form-field">
                                    <input name="importo" class="form-control" id="importo" style="width: auto; text-align: right; float: left;" type="text" size="11" maxlength="10" value="" data-bind="numericTextSeparator: cbillDataEntry.Bill.Amount">
                                    <label>&nbsp;EUR</label>
                                </div>
                            </div>
                            <div class="form-field-input col-xs-4">
                                <div id="IdentificativoBill"></div>
                                <label class="control-label" for="identificativoBolletta">
                                    Codice identificativo del pagamento
                                    &nbsp;
                                    
                                </label>                                
                                <div class="form-field">
                                    <input name="identificativoBolletta" class="form-control" id="identificativoBolletta" type="text" size="48" maxlength="36" value="" placeholder="Inserisci l'identificativo bolletta" data-bind="value: cbillDataEntry.Bill.BillNumber">
                                </div>
                            </div>
                            
                            <div class="form-field-input col-xs-4">
                                <div id="DataBill"></div>
                                <label class="control-label" for="dataEsecuzione">                                    
                                    Data esecuzione &nbsp;
                                    
                                </label>
                                <div class="form-field">
                                    <div class="col-xs-6">
                                        <input name="dataEsecuzione" class="form-control hasDatepicker" id="dataEsecuzione" type="text" maxlength="10" data-bind="dateText: cbillDataEntry.Payment.ValueDate">
                                        
                                    </div>
                                    <div class="col-xs-3">
                                        <a class="icon-replace icon-calendar active col-xs-1" href="javascript:void(0);" id="imgCalendario">Calendario</a>
                                        

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div class="pull-right margin-bottom20">
            <button class="btn btn-primary" id="btnConferma" type="button">Avanti</button>
        </div>
    </div>
<script type="text/javascript">
                                            $(function () { koRegisterViewModel("cbillDataEntry",{"BillDetail":null,"Rapporto":{"Rapporto":{"Rapporto":{"IdAzienda":"588536","Identificativo":"1922806","CodiceIban":"IT38V0503433473000000011905","CodiceAbi":"05034","CodiceCab":"33473","CodiceSwift":"BAPPIT21792","CodiceFiliale":"0792","NumeroRapporto":"079200011905","CodiceDivisa":"EUR","Descrizione":"C.P.C. INOX SPA","DescrizionePersonalizzata":"C.P.C. INOX SPA","DescrizioneBanca":null,"DescrizioneFiliale":null,"Tipologia":null,"Identifier":{"Crypt":"uxzY3133BRJrPX/O2ETP4NsSzfWGVA138PHHTlqSTKf9+2/KDvaDPJ5Vm8ytY4hk","Hash":"7C18192AA65AA4FB547F15B8822617205A3E866D08552A18C543DD2CBD4C1EDB"},"RapportoAzienda":null},"SaldoContabile":{"Valore":411201.61,"CodiceDivisa":"EUR"},"SaldoLiquido":{"Valore":411201.61,"CodiceDivisa":"EUR"},"SaldoDisponibile":{"Valore":461201.61,"CodiceDivisa":"EUR"},"SaldoIstantaneo":{"Valore":411201.61,"CodiceDivisa":"EUR"},"Identifier":{"Crypt":"uxzY3133BRJrPX/O2ETP4NsSzfWGVA138PHHTlqSTKf9+2/KDvaDPJ5Vm8ytY4hk","Hash":"7C18192AA65AA4FB547F15B8822617205A3E866D08552A18C543DD2CBD4C1EDB"}},"Azienda":{"IdAzienda":588536,"CodiceAzienda":"800015887","RagioneSociale":"C.P.C. INOX SPA","CodiceSia":"73586","CodiceCuc":"VANTAGGT","StatoAzienda":1}},"Biller":{"Id":"0","Description":null},"Payment":{"DueDate":"2019-09-27T00:00:00+02:00","ValueDate":"2019-09-27T00:00:00+02:00","GrandTotal":0.0,"ChargeAmmount":0.0,"TranCode":null},"Bill":{"BillNumber":"Bolletta","Amount":32.0}}, true);
        $(function() {
            //debugger;
            var selectedId = '1922806';
            var numElementForNotPagination = 8;
            //Logger.debugMessage('==============');
            //Logger.debugMessage('esegue lo script di Knockout');

            var ctx = '#2080bfee7dd0461e8a1c2fe9d2912e83_4';
            //var bridgeItem = $('#bridgeRapporto', ctx);

            $('#chkSelectAll', ctx).change(function() {
                if (this.checked) {
                    $('.tabellaSelezioneCC').css('opacity', '0.6');
                    var overlay = $('<div class="cc-overlay" ></div>');
                    $('.tabellaSelezioneCC').prepend(overlay);
                } else {
                    $('.tabellaSelezioneCC').css('opacity', '1');
                    $('.cc-overlay').remove();
                }
            });

            $('.btnSelezioneCC', ctx).click(function() {
                var that = $(this);
                if (!that.hasClass('open'))
                    $('.tabSelezioneCC', ctx).slideDown(200);
                else
                    $('.tabSelezioneCC', ctx).slideUp(300);

                that.toggleClass('open');
            });

            $('.tabSelezioneCC', ctx).hide();

            var items = [{"Rapporto":{"Rapporto":{"IdAzienda":"588536","Identificativo":"1922806","CodiceIban":"IT38V0503433473000000011905","CodiceAbi":"05034","CodiceCab":"33473","CodiceSwift":"BAPPIT21792","CodiceFiliale":"0792","NumeroRapporto":"079200011905","CodiceDivisa":"EUR","Descrizione":"C.P.C. INOX SPA","DescrizionePersonalizzata":"C.P.C. INOX SPA","DescrizioneBanca":null,"DescrizioneFiliale":null,"Tipologia":null,"Identifier":{"Crypt":"uxzY3133BRJrPX/O2ETP4NsSzfWGVA138PHHTlqSTKf9+2/KDvaDPJ5Vm8ytY4hk","Hash":"7C18192AA65AA4FB547F15B8822617205A3E866D08552A18C543DD2CBD4C1EDB"},"RapportoAzienda":null},"SaldoContabile":{"Valore":411201.61,"CodiceDivisa":"EUR"},"SaldoLiquido":{"Valore":411201.61,"CodiceDivisa":"EUR"},"SaldoDisponibile":{"Valore":461201.61,"CodiceDivisa":"EUR"},"SaldoIstantaneo":{"Valore":411201.61,"CodiceDivisa":"EUR"},"Identifier":{"Crypt":"uxzY3133BRJrPX/O2ETP4NsSzfWGVA138PHHTlqSTKf9+2/KDvaDPJ5Vm8ytY4hk","Hash":"7C18192AA65AA4FB547F15B8822617205A3E866D08552A18C543DD2CBD4C1EDB"}},"Azienda":{"Identifier":{"Crypt":"aDLnMcBfzcl+JYvYXJ1Z8p16ufZ1hHyEGfQ5Af9EQ6HtylOINUIgPfYkjWvLsaY9","Hash":"E12783BA2384637DFA2B43CBECF2A2A51E2963C92AB2754BD985ED53C65BC0D2"},"IdAzienda":588536,"CodiceAzienda":"800015887","RagioneSociale":"C.P.C. INOX SPA","CodiceSia":"73586","CodiceCuc":"VANTAGGT","StatoAzienda":1}}];
            //TODO Introdotto da David
            
            //TODO Introdotto da David
            var numElem = items.length;
            if (numElem <= 1) {
                $('.btnSelezioneCC', ctx).removeClass('active');
                $('.btnSelezioneCC', ctx).addClass('hidden');
                $('#SelettoreRapportiIcon', ctx).addClass('hidden');
            }


            $('#selezioneRapportoSingolo').hide();
            $('#panelMessageRapporti').show();



            var param = {
                dataSource: items,
                rowCreator: function(rapportoeSaldo) {
                    var tmpSaldo = rapportoeSaldo.Rapporto;
                    var tmpRapporto = rapportoeSaldo.Rapporto.Rapporto;

                    if (rapportoeSaldo && tmpSaldo) {
                        var saldoDisplay = function(saldo) {
                            if (saldo) {
                                return FormatAmmountDecimal(saldo.Valore) + ' ' + GetCurrencySign(saldo.CodiceDivisa);
                            }
                            return "&nbsp;";
                        }
                        return '<tr>' +
                            '<td class="hidden" style="text-align: center"><input type="radio" name="codContoCorrente" value="001|0004|000400585163" checked="checked"></td>'+
                            '<td> ' + (tmpRapporto.NumeroRapporto || '') + ' </td> '+
                            '<td>' + (tmpRapporto.CodiceAbi || '') + ' </td> '+
                            '<td>' + (tmpRapporto.CodiceCab || '') + ' </td> '+
                            '<td>' + (tmpRapporto.Descrizione || '') + '</td> '+
                            '<td class="oRight">' + saldoDisplay(tmpSaldo.SaldoContabile) + '</td> '+
                            '<td class="oRight">' + saldoDisplay(tmpSaldo.SaldoDisponibile) + '</td> '+
                            '<td class="oRight hidden">&nbsp;</td> '+
                            '</tr>';
                    }
                    return '';
                },

                updateAccount: function(rapportoSelezionato) {
                    aggiornaBridgeRapporto(rapportoSelezionato);
                    return aggiornaIntestazione(rapportoSelezionato);
                },
                initialItemSelector: function(index, item) {
                    if (selectedId == '') {
                        return false;
                    } else {
                        if (item.Rapporto != null) {
                            if (item.Rapporto.Rapporto != null) {
                                if (selectedId == item.Rapporto.Rapporto.Identificativo) {
                                    return true;
                                }
                            }
                        }
                    }
                    return false;
                },
                selectFirst: true,
                minElementForNotPagination: numElementForNotPagination
            };

            function aggiornaBridgeRapporto(rapportoSelezionato) {
                koRootViewModel.cbillDataEntry.Rapporto(rapportoSelezionato);
            }

            function negative(number) {
                if (number != null) {
                    var regExp=/^\-\d{0,50}(\.(\d)*)?$/g;
                    if(number.toString().match(regExp) != null){
                        return true;
                    }else {
                        return false;
                    }
                }
                return false;
            }

            function aggiornaIntestazione(rapportoSelezionato) {
                var ctxRapportoSel = ctx;
                if (rapportoSelezionato) {

                    var tmpSaldo = rapportoSelezionato.Rapporto;
                    var tmpRapporto = rapportoSelezionato.Rapporto.Rapporto;

                    /*
                    var saldoDispIsNegative = negative(tmpSaldo.SaldoDisponibile.Valore);
                    var saldoContIsNegative = negative(tmpSaldo.SaldoContabile.Valore);
                    */

                    var tmpSaldoDisponibile = null;
                    if (tmpSaldo.SaldoDisponibile)
                        tmpSaldoDisponibile = tmpSaldo.SaldoDisponibile.Valore;
                    var tmpSaldoContabile = null;
                    if (tmpSaldo.SaldoContabile)
                        tmpSaldoContabile = tmpSaldo.SaldoContabile.Valore;

                    var saldoDispIsNegative = negative(tmpSaldoDisponibile);
                    var saldoContIsNegative = negative(tmpSaldoContabile);


                    $('#intestazione', ctxRapportoSel).html(tmpRapporto.DescrizionePersonalizzata == null ? (tmpRapporto.Descrizione == null ? '' : tmpRapporto.Descrizione) : tmpRapporto.DescrizionePersonalizzata);
                    $('#agenzia', ctxRapportoSel).html((tmpRapporto.CodiceAbi == null ? '' : tmpRapporto.CodiceAbi) + " - " + (tmpRapporto.CodiceCab == null ? '' : tmpRapporto.CodiceCab));

                    $('#disponibile', ctxRapportoSel).removeClass('redClassInternal');
                    $('#contabile', ctxRapportoSel).removeClass('redClassInternal');

                    if (saldoDispIsNegative) {
                        $('#disponibile', ctxRapportoSel).addClass('redClassInternal');
                        $('#disponibile', ctxRapportoSel).html( tmpSaldoDisponibile == null ? 'N.D.' : FormatAmmountDecimal(tmpSaldoDisponibile)  + " " + (tmpRapporto.CodiceDivisa == null ? 'N.D.' : tmpRapporto.CodiceDivisa));
                    } else {
                        $('#disponibile', ctxRapportoSel).html( tmpSaldoDisponibile == null ? 'N.D.' : FormatAmmountDecimal(tmpSaldoDisponibile) + " " + (tmpRapporto.CodiceDivisa == null ? 'N.D.' : tmpRapporto.CodiceDivisa));
                    }

                    if (saldoContIsNegative) {
                        $('#contabile', ctxRapportoSel).addClass('redClassInternal');
                        $('#contabile', ctxRapportoSel).html( tmpSaldoContabile == null ? "N.D." : FormatAmmountDecimal(tmpSaldoContabile)  + " " + (tmpRapporto.CodiceDivisa == null ? 'N.D.' : tmpRapporto.CodiceDivisa));
                    } else {
                        $('#contabile', ctxRapportoSel).html( tmpSaldoContabile == null ? "N.D." : FormatAmmountDecimal(tmpSaldoContabile)  + " " + (tmpRapporto.CodiceDivisa == null ? 'N.D.' : tmpRapporto.CodiceDivisa));
                    }



                    $('#iban', ctxRapportoSel).html((tmpRapporto.CodiceIban == null ? '' : tmpRapporto.CodiceIban));
                    
                    $('#numero', ctxRapportoSel).html((tmpRapporto.NumeroRapporto == null ? '' : tmpRapporto.NumeroRapporto));


                    $('#selezioneRapportoSingolo').show();
                    $('#panelMessageRapporti').hide();

                }
                else {
                    $('#intestazione', ctxRapportoSel).html('');
                    $('#agenzia', ctxRapportoSel).html('');
                    $('#disponibile', ctxRapportoSel).html('');
                    $('#contabile', ctxRapportoSel).html('');
                    $('#numero', ctxRapportoSel).html('');
                    $('#iban', ctxRapportoSel).html('');

                }
                // chiudo la dataTable dopo aver selezionato un elemento ed aggiornato l'intestazione
                $('.btnSelezioneCC', ctx).removeClass('open');
                $('.tabSelezioneCC', ctx).slideUp(300);
            }

            $('#itemSelectorTable', ctx).itemSelector({ param: param });
        });
            koUpdateViewModelBinding();}); </script>
<script type="text/javascript">
    $(function () {
        var jPanel = $('#2080bfee7dd0461e8a1c2fe9d2912e83_3');

        $('.icon-replace.icon-help.active.link', jPanel).click(
            function () {
                var parameter = {};
                parameter.isPopup = true;
                parameter.searchUrl = '/YouBiz.Web/Help/Help/GetHelp';
                parameter.functionId = 'cbill_001';
                showHelp(parameter, jPanel);
            });
    });
</script>

<script type="text/javascript">
    $(function () {
        var jPanel = $('#2080bfee7dd0461e8a1c2fe9d2912e83_3');
        $('#dataEsecuzione',jPanel).datepick({
            regional: 'it',
            trigger: "#imgCalendario",
            beforeShow: function() {
                $('#ui-datepicker-div').addClass("calendar-box ybb-calendar");
            }
        });
        
    });
</script>

<script type="text/javascript">
    $(function() {
        var jPanel = $('#2080bfee7dd0461e8a1c2fe9d2912e83_3');
        $('#btnConferma', jPanel).click(
            function () {
                var descr = $("#biller",jPanel).val();
                if (descr.length == 0) {
                    koRootViewModel.cbillDataEntry.Biller.Id = "";
                    koRootViewModel.cbillDataEntry.Biller.Description = "";
                }
                koParentTargetGoTo('/YouBiz.Web/Cbill/Cbill/Verifica', $('#2080bfee7dd0461e8a1c2fe9d2912e83_3'));
            });
    });
</script>

<script type="text/javascript">
    function __highlight(s, t) {       
        var matcher = new RegExp("("+$.ui.autocomplete.escapeRegex(t)+")", "i" );
        return s.Description.replace(matcher, "<strong>$1</strong>");
    }
   
    
    

    $(function () {
        var jPanel = $('#2080bfee7dd0461e8a1c2fe9d2912e83_3');
        var lista = listaInCache || [];
        
        $("#biller", jPanel).autocomplete({

            minLength: 1,
            delay: 300,

            source: function (req, resp) {

                var re = $.ui.autocomplete.escapeRegex(req.term);
                var matcher = new RegExp(re, "i");

                var maxItems = 30;
                var itemsCount = 0;
                var arry = [];

                $.each(lista, function (index, item) {
                    if (itemsCount >= maxItems)
                        return false;
                    var toRet = matcher.test(item.Description);
                    if (toRet) {
                        arry.push(item);
                        itemsCount++;
                    }
                    return true;
                });

                resp($.map(arry, function (item) {
                    return { Description: __highlight(item, req.term), value: item };
                }));


            },
            select: function (event, ui) {
                koRootViewModel.cbillDataEntry.Biller.Id = ui.item.value.Id;
                koRootViewModel.cbillDataEntry.Biller.Description = ui.item.value.Description;
                $("#biller", jPanel).val(ui.item.value.Description);
                $("#codSia", jPanel).val(ui.item.value.Id);
                event.preventDefault();

            },
            focus: function (event, ui) {
                koRootViewModel.cbillDataEntry.Biller.Id = ui.item.value.Id;
                koRootViewModel.cbillDataEntry.Biller.Description = ui.item.value.Description;
                $("#biller", jPanel).val(ui.item.value.Description);
                $("#codSia", jPanel).val(ui.item.value.Id);
                event.preventDefault();

            },

            //minLength: 1
        }).data("ui-autocomplete")._renderItem = function (ul, item) {
            return $("<li></li>")
                .data("item.autocomplete", item)
                .append($("<a></a>").html(item.Description))
                .appendTo(ul);

        };


        
        

        //Ripropone la descrizione partendo da codId che ho nel koRootViewModel salvato in precedenza
        var codsia = $("#codSia",jPanel).val(koRootViewModel.cbillDataEntry.Biller.Id);
        if (codsia.val() != "") {
            var biller = $.grep(lista, function(e){ return e.Id == codsia.val(); })[0];
            if (biller != undefined) {
                $('#biller',jPanel).val(biller.Description);
            }
        }
        
    });
</script>







































</div>