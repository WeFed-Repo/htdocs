(function(n){n.widget("tm.swapper",{options:{allTemplates:null,currentUserAllPreference:null,saveUrl:null,urlWidgetToolBox:null,urlWidgetUserPref:null,widgets:null,peekArea:null,dropAreas:null,panelMessageSave:null,panelMessageAlert:null,panelMessageError:null},reset:function(n){this._resetEditor(this.options,n)},_init:function(){Logger.debugMessage("sono in init");this._resetEditor(this.options,!0)},_create:function(){Logger.debugMessage("sono in create")},_initializeToolboxItems:function(t){var i=[],r=this;return n.each(t,function(n,t){i[n]=r._buildToolBoxItem(t,n,r)}),i},_buildToolBoxItem:function(t,i,r){var u={template:t,toolboxIndex:i,JpanelToolBox:null,JpanelUser:[],itemChunkToolbox:null,itemChunkDropped:null,getUserItem:function(){u.template.IsMultipleInstance||u.JpanelToolBox.hide();var t=n("<li><\/li>").append(n(u.itemChunkDropped)).addClass("listyle");return t.data("owner",u).data("IsToolBoxItem",!1).data("userPref",{WidgetType:u.template.WidgetType}),u.JpanelUser.push(t),t},recycleUserItem:function(n){if(!u.template.IsOptional&&u.JpanelUser.length==1)return!1;u.JpanelUser.indexOf||(u.JpanelUser.indexOf=function(n){return jQuery.inArray(n,this)});var t=u.JpanelUser.indexOf(n);return t>=-1&&u.JpanelUser.splice(t,1),u.JpanelUser.length<=0&&!u.template.IsMultipleInstance&&u.JpanelToolBox.show(),u.updateUserPref(n,-1,-1),!0},getToolboxItem:function(){return u.JpanelToolBox.empty(),u.JpanelToolBox.append(n(u.itemChunkToolbox)),u.JpanelToolBox},isToolboxItem:function(n){if(n){var t=n.data("IsToolBoxItem");if(typeof t=="boolean")return t}return!1},updateUserPref:function(n,t,i){var h=n.data("IsToolBoxItem"),f,e,o,s;h||(f=n.data("userPref"),f&&f.WidgetType==u.template.WidgetType&&(Logger.debugMessage("updating preferences: "+t+"-"+i+" "+JSON.stringify(f)),f.ColumnId!==undefined&&(e=r.options.dropAreas[f.ColumnId],e&&(e.userPrefByCol.indexOf||(e.userPrefByCol.indexOf=function(n){return jQuery.inArray(n,this)}),o=e.userPrefByCol.indexOf(f),o>-1&&e.userPrefByCol.splice(o,1))),f.ColumnId=t,s=r.options.dropAreas[f.ColumnId],s&&s.userPrefByCol.splice(i,0,f)))}};return u.JpanelToolBox=n("<li><\/li>").data("owner",u).data("IsToolBoxItem",!0).addClass("listyle"),u.itemChunkToolbox=r._createHtmlForElementInToolbox(u),u.itemChunkDropped=r._createHtmlForElementInDropZone(u),u},_createHtmlForElementInToolbox:function(t){var i=function(i){t.itemChunkToolbox=i;t.JpanelToolBox.empty();var r=n(t.itemChunkToolbox);t.JpanelToolBox.append(r)};communicationSendObject(this.options.urlWidgetToolBox,t.template,i)},_createHtmlForElementInDropZone:function(t){var i=function(i){t.itemChunkDropped=i;n.each(t.JpanelUser,function(i,r){r.empty();r.append(n(t.itemChunkDropped))})};communicationSendObject(this.options.urlWidgetUserPref,t.template,i)},_resetEditor:function(t,i){try{n.each(t.dropAreas,function(n,t){t.userPrefByCol=[]});t.widgets=this._initializeToolboxItems(t.allTemplates);var r=[];n.each(this.options.dropAreas,function(n,t){r[t.ColumnId]=[]});n.each(t.widgets,function(u,f){var o=[],e=0,s=i?t.currentUserAllPreference:[];n.each(s,function(t,i){if(i.WidgetType==f.template.WidgetType){var r=n.extend({},i);f.template.UseTemplateLayout&&(r.ColumnId=f.template.ColumnId,r.RowId=f.template.RowId);o[e++]=r}return!0});e!=0||f.template.IsOptional||(o[e++]=n.extend({},f.template));t.peekArea.JPanel.append(f.getToolboxItem());e>0&&n.each(o,function(n,t){var i=r[t.ColumnId];i||(i=[],r[t.ColumnId]=i);i.push({widget:f,userPref:t})})});n.each(r,function(i,r){var u=t.dropAreas[i];u&&(r.sort(function(n,t){return n.userPref.RowId-t.userPref.RowId}),n.each(r,function(t,i){var r=i.widget.getUserItem();i.widget.updateUserPref(r,u.ColumnId,t);t==0?u.JPanel.prepend(n(r)):n("li:eq("+(t-1)+")",u.JPanel).after(n(r))}))})}catch(u){alert(u)}},cancelCurrentEditor:function(){this._resetEditor(this.options,!0)},saveCurrentSettings:function(){var u=this.options.panelMessageSave,f=this.options.panelMessageError,t,i,r;Logger.debugMessage("dumping preferences start");t=[];n.each(this.options.dropAreas,function(i,r){var u=0;Logger.debugMessage("==============");Logger.debugMessage("begin drop area "+r.ColumnId);n.each(r.userPrefByCol,function(i,f){var e=n.extend({},f);e.ColumnId=r.ColumnId;e.RowId=u++;t.push(e);Logger.debugMessage(i+" - pref: "+JSON.stringify(e))});Logger.debugMessage("==============")});i=function(){u.show()};r=function(){f.show()};communicationSendObject(this.options.saveUrl,t,i,r)},extactOwner:function(n){if(n){var t=n.data("owner");if(t)return t}return null},getPeekArea:function(){return this.options.peekArea},getDropAreas:function(){return this.options.dropAreas}})})(jQuery);
//# sourceMappingURL=tm.swapper.min.js.map
