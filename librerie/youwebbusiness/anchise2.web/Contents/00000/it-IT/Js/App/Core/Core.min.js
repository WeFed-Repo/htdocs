function cbiValidation(){var n,t=event.which?event.which:event.keyCode,i=String.fromCharCode(n);return t>31&&/^[0-9a-zA-Z\/\-\?:\(\)\.,'\+ ]+$/.test(i)}var Export,Http,PropertySelector,App;(function(n){(function(n){var t=function(){function n(n){typeof n=="undefined"&&(n=null);this.IsSortAscending=ko.observable(!1);this.Size=ko.observable(10);this.SortColumn=ko.observable(1);this.StartIndex=ko.observable(1);n!==null&&(this.IsSortAscending(n.IsSortAscending!=null?n.IsSortAscending:!1),this.Size(n.Size||10),this.SortColumn(n.SortColumn||1),this.StartIndex(n.StartIndex||1))}return n}();n.BasePagingFilterAsync=t})(n.Core||(n.Core={}));var t=n.Core})(App||(App={})),function(n){var t=function(n,t,i){for(var u=[],r=0;r<t.length;r++)resourceForm=t[r].hasOwnProperty("fieldName")?{action:t[r].url,parameter:i,target:"_self",serialization:{fieldName:t[r].fieldName,mode:!1}}:{action:t[r].url,parameter:i,target:"_self"},u.push({id:"print",type:t[r].type,title:"Export",iconClass:"anchise-icon anchise-icon-export-"+t[r].type,saveAll:{resourceForm:resourceForm}});sdk.print("#"+n).create({docs:u,eventHandler:function(){}})};n.print=t}(Export||(Export={})),function(n){var t=function(n){console.log("readyState: "+n.readyState);switch(n.readyState){case 0:uiHelper.Alert({text:"Network Error: è successo qualcosa di inaspettato alla rete, si prega di controllare che il dispositivo sia connesso ad Internet.",cssClass:"alert-danger"});break;case 4:var t=n.getResponseHeader("Content-Type");n.status!=400&&n.status!=404&&t!="application/json"&&uiHelper.Alert({text:"Error: è successo qualcosa di inaspettato durante il tentativo di connessione al server.",cssClass:"alert-danger"});break;case 1:case 2:case 3:default:uiHelper.Alert({text:"Error: è successo qualcosa di inaspettato durante il tentativo di connessione al server.",cssClass:"alert-danger"})}},i=function(n,i){return $.ajax({contentType:"application/json",url:n,method:"POST",data:i,beforeSend:function(){uiHelper.ShowLoader()},error:t})},r=function(n){return $.ajax({contentType:"application/json",url:n,method:"GET",beforeSend:function(){uiHelper.ShowLoader()},error:t})},u=function(n,t){try{tmtmon.enrich()}catch(r){console.log(r)}return i(n,t)};n.Post=i;n.PostWithTxMon=u;n.Get=r}(Http||(Http={})),function(n){(function(n){n.SearchJsonResult=function(n){typeof n=="undefined"&&(n=null);this.HasError=!0;this.HasWarning=!1;this.Messages=null;this.TotaleElementi=0;this.PagingFilter=null;this.Response=null;n!==null&&(this.HasError=n.HasError,this.HasWarning=n.HasWarning,this.Messages=n.Messages,this.TotaleElementi=n.TotaleElementi,this.PagingFilter=n.PagingFilter,this.Response=n.Response)}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){n.StandardJsonResult=function(n){typeof n=="undefined"&&(n=null);this.HasError=!0;this.HasWarning=!1;this.Messages=null;this.Response=null;this.CssClass="success";n!==null&&(this.HasError=n.HasError,this.HasWarning=n.HasWarning,this.Messages=n.Messages,this.Response=n.Response,n.HasWarning&&!n.HasError&&(this.CssClass="alert"))}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){n.UiButton=function(n){typeof n=="undefined"&&(n=null);this.Label=null;this.Callback=$.noop;n!==null&&(this.Label=n.Label||"",this.Callback=n.Callback||$.noop)}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){n.UiComponent=function(n){typeof n=="undefined"&&(n=null);this.Name=null;this.Params=null;n!==null&&(this.Name=n.Name,this.Params=n.Params)}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){var t=function(){function n(n){typeof n=="undefined"&&(n=null);var t=this;t.ErrorMessage=ko.observable(null);t.ErrorMessageRes=ko.observable(null);t.PropertyName=ko.observable(null);n!=null&&(t.ErrorMessage(n.ErrorMessage),t.ErrorMessageRes(n.ErrorMessageRes),t.PropertyName(n.PropertyName))}return n}();n.ValidationMessage=t})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){var t=function(n){var f=n%19,t=Math.floor(n/100),e=n%100,s=Math.floor(t/4),h=t%4,c=Math.floor((t+8)/25),l=Math.floor((t-c+1)/3),i=(19*f+t-s-l+15)%30,a=Math.floor(e/4),v=e%4,r=(32+2*h+2*a-i-v)%7,o=Math.floor((f+11*i+22*r)/451),y=Math.floor((i+r-7*o+114)/31),p=(i+r-7*o+114)%31+1,u=new Date(n+"-"+y+"-"+p);return u.setTime(u.getTime()+864e5),u.getTime()};n.NoWeekendsOrHolidays=function(n){var f=$.datepicker.noWeekends(n);if(f[0]){var u=[[1,1],[6,1],[25,4],[1,5],[2,6],[15,8],[1,11],[8,12],[25,12],[26,12]],e=new Date,o=e.getFullYear(),r=new Date(t(o));for(e>r?(r=new Date(t(o+1)),u.push([r.getDay(),r.getMonth()+1])):u.push([r.getDay(),r.getMonth()+1]),i=0;i<u.length;i++)if(n.getMonth()==u[i][1]-1&&n.getDate()==u[i][0])return[!1,""];return[!0,""]}return f}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){var r=[1,0,5,7,9,13,15,17,19,21,2,4,18,20,11,3,6,8,12,14,16,10,22,25,24,23],u=function(n){return n=n||"",n.substring(15)},f=function(n){return n=n||"",n.substr(5,5)},e=function(n){return n=n||"",n.substr(10,5)},o=function(n){return n=n||"",n.substr(0,2)},s=function(n){return n=n||"",n.substr(2,2)},h=function(n){return n=n||"",n.substr(4,1)},t=function(n,t){var i=n.charCodeAt(0);return 48<=i&&i<=57&&(i=i-48),65<=i&&i<=90&&(i=i-65,t&&(i+=10)),i},c=function(n){for(var u=" "+n,e=0,f,o,s,u=u.toUpperCase(),i=1;i<u.length;i++)f=t(u[i],!1),e+=i%2==0?f:r[f];return o=e%26,s=String.fromCharCode(o+65),s},l=function(n){for(var r=n+"IT00",f="",e,o,s,r=r.toUpperCase(),u=0;u<r.length;u++)e=t(r[u],!0),f+=e;return o=p(f),s=98-o,i(""+s,2)},i=function(n,t){while(n.length<t)n="0"+n;return n},a=function(n){return n.toUpperCase()},v=function(n){return n.toUpperCase()},y=function(n){return i(n,12)},p=function(n){for(var t=0,i=0;i<n.length;++i)t=(t*10+parseInt(n.charAt(i)))%97;return t},w=function(n,t,i,r){var u,f,e;return r=r.toUpperCase(),u=n+t+i,f=c(u),u=f+u,e=l(u),r+e+u};n.GetConto=u;n.GetCab=e;n.GetAbi=f;n.GetPaese=o;n.GetCheckDigit=s;n.GetCin=h;n.FixAbi=a;n.FixCab=v;n.FixConto=y;n.CalcolaIBAN=w})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){var t={DISTINTE:"DISTINTE",DISPOSIZIONI:"DISPOSIZIONI",FILTRO_DISTINTE:"FILTRO_DISTINTE",FILTRO_DISPOSIZIONI:"FILTRO_DISPOSIZIONI",ESITI:"ESITI",FILTRO_ESITI:"FILTRO_ESITI",CARTINFO:"CARTINFO"},i=function(n,t){if(typeof n!="string")throw"key must be a string";sessionStorage.setItem(n,ko.toJSON(t))},r=function(n){if(typeof n!="string")throw"key must be a string";return JSON.parse(sessionStorage.getItem(n))};n.GetSessionStorage=r;n.SetSessionStorage=i;n.SetDistinteSessionStorage=function(n){i(t.DISTINTE,n)};n.GetDistinteSessionStorage=function(){return r(t.DISTINTE)};n.SetDisposizioniSessionStorage=function(n){i(t.DISPOSIZIONI,n)};n.GetDisposizioniSessionStorage=function(){return r(t.DISPOSIZIONI)};n.SetEsitiSessionStorage=function(n){i(t.ESITI,n)};n.GetEsitiSessionStorage=function(){return r(t.ESITI)};n.SetFiltroDistinteSessionStorage=function(n){i(t.FILTRO_DISTINTE,n)};n.GetFiltroDistinteSessionStorage=function(){return r(t.FILTRO_DISTINTE)};n.SetFiltroDisposizioniSessionStorage=function(n){i(t.FILTRO_DISPOSIZIONI,n)};n.GetFiltroDisposizioniSessionStorage=function(){return r(t.FILTRO_DISPOSIZIONI)};n.SetFiltroEsitiSessionStorage=function(n){i(t.FILTRO_ESITI,n)};n.GetFiltroEsitiSessionStorage=function(){return r(t.FILTRO_ESITI)};n.SetCartInfoSessionStorage=function(n){i(t.CARTINFO,n)};n.GetCartInfoSessionStorage=function(){return r(t.CARTINFO)}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){(function(n){var t=function(n,t){if(!(typeof t=="function"))throw"'action' is not a function";var i=parseNumber(n);return isNaN(i)?!1:t(i)},r=function(n){return n===null||typeof n=="undefined"},f=function(n){return r(n)||n===""?!0:!1},e=function(n,i){return t(n,function(n){return n<i})},o=function(n,i){return t(n,function(n){return n<=i})},s=function(n,i){return t(n,function(n){return n>i})},h=function(n,i){return t(n,function(n){return n>=i})},c=function(n,t){return n.length>=t},l=function(n,t){return n.length<=t},a=function(n){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)},i=function(n,t,i){var r=moment(n.trim(),[t]).toDate();return r.getFullYear()<1970&&(r=moment(moment(n.trim(),[i]).toDate())),r},v=function(n){return i(n,"DD/MM/YYYY","DD/MM/YY")},y=function(n){return i(n,"DD/MM/YYYYThhmmss","DD/MM/YYThhmmss")},p=function(n,t,r){return i(n,t,r)},w=function(n){return moment(n).format("DD/MM/YYYY")},b=function(n){return moment(n).format("DD/MM/YYYYThhmmss")},u=function(n){var t=parseNumber(n);return isNaN(t)?null:t.toFixed(2).replace(".",",")},k=function(n){return u(n).replace(/\B(?=(\d{3})+(?!\d))/g,".")},d=function(n){return typeof n=="number"?n:(n=n.toString().replace(/\./g,""),parseFloat(n.replace(",",".")))};n.IsNullOrUndefined=r;n.IsNullOrEmpty=f;n.IsLess=e;n.IsLessEqual=o;n.IsGreat=s;n.IsGreatEqual=h;n.MinLength=c;n.MaxLength=l;n.IsEmail=a;n.ParseDate=v;n.FormatDate=w;n.ParseDateTime=y;n.FormatDateTime=b;n.ParseDateTimeFormatted=p;n.ParseNumber=d;n.FormatNumber=u;n.FormatNumberSeparation=k})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){typeof define=="function"&&define.amd?define(["jquery"],n):jQuery.sammy=window.Sammy=n(jQuery)}(function(n){var t,p="([^/]+)",s=/:([\w\d]+)/g,c=/\?([^#]*)?$/,r=function(n){return Array.prototype.slice.call(n)},i=function(n){return Object.prototype.toString.call(n)==="[object Function]"},u=function(n){return Object.prototype.toString.call(n)==="[object Array]"},l=function(n){return Object.prototype.toString.call(n)==="[object RegExp]"},e=function(n){return decodeURIComponent((n||"").replace(/\+/g," "))},a=encodeURIComponent,v=function(n){return String(n).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},f=function(n){return function(){return this.route.apply(this,[n].concat(Array.prototype.slice.call(arguments)))}},h={},o=!!(window.history&&history.pushState),y=[];return t=function(){var u=r(arguments),f,e;return(t.apps=t.apps||{},u.length===0||u[0]&&i(u[0]))?t.apply(t,["body"].concat(u)):typeof(e=u.shift())=="string"?(f=t.apps[e]||new t.Application,f.element_selector=e,u.length>0&&n.each(u,function(n,t){f.use(t)}),f.element_selector!=e&&delete t.apps[e],t.apps[f.element_selector]=f,f):void 0},t.VERSION="0.7.6",t.addLogger=function(n){y.push(n)},t.log=function(){var i=r(arguments);i.unshift("["+Date()+"]");n.each(y,function(n,r){r.apply(t,i)})},typeof console!="undefined"?typeof window.console.log=="function"&&i(window.console.log.apply)?t.addLogger(function(){window.console.log.apply(window.console,arguments)}):t.addLogger(function(){window.console.log(arguments)}):typeof console!="undefined"&&t.addLogger(function(){console.log.apply(console,arguments)}),n.extend(t,{makeArray:r,isFunction:i,isArray:u}),t.Object=function(t){return n.extend(this,t||{})},n.extend(t.Object.prototype,{escapeHTML:v,h:v,toHash:function(){var t={};return n.each(this,function(n,r){i(r)||(t[n]=r)}),t},toHTML:function(){var t="";return n.each(this,function(n,r){i(r)||(t+="<strong>"+n+"<\/strong> "+r+"<br />")}),t},keys:function(n){var t=[];for(var r in this)i(this[r])&&n||t.push(r);return t},has:function(t){return this[t]&&n.trim(this[t].toString())!==""},join:function(){var n=r(arguments),t=n.shift();return n.join(t)},log:function(){t.log.apply(t,arguments)},toString:function(t){var r=[];return n.each(this,function(n,u){(!i(u)||t)&&r.push('"'+n+'": '+u.toString())}),"Sammy.Object: {"+r.join(",")+"}"}}),t.targetIsThisWindow=function(t,i){var u=n(t.target).closest(i),r;return u.length===0?!0:(r=u.attr("target"),!r||r===window.name||r==="_self")?!0:r==="_blank"?!1:r==="top"&&window===window.top?!0:!1},t.DefaultLocationProxy=function(n,t){this.app=n;this.is_native=!1;this.has_history=o;this._startPolling(t)},t.DefaultLocationProxy.fullPath=function(n){var t=n.toString().match(/^[^#]*(#.+)$/),i=t?t[1]:"";return[n.pathname,n.search,i].join("")},n.extend(t.DefaultLocationProxy.prototype,{bind:function(){var u=this,r=this.app,i=t.DefaultLocationProxy;n(window).bind("hashchange."+this.app.eventNamespace(),function(n,t){u.is_native!==!1||t||(u.is_native=!0,window.clearInterval(i._interval),i._interval=null);r.trigger("location-changed")});o&&!r.disable_push_state&&(n(window).bind("popstate."+this.app.eventNamespace(),function(){r.trigger("location-changed")}),n(document).delegate("a","click.history-"+this.app.eventNamespace(),function(n){if(!n.isDefaultPrevented()&&!n.metaKey&&!n.ctrlKey){var f=i.fullPath(this),e=this.hostname?this.hostname:function(n){var t=document.createElement("a");return t.href=n.href,t.hostname}(this);if(e==window.location.hostname&&r.lookupRoute("get",f)&&t.targetIsThisWindow(n,"a"))return n.preventDefault(),u.setLocation(f),!1}}));i._bindings||(i._bindings=0);i._bindings++},unbind:function(){n(window).unbind("hashchange."+this.app.eventNamespace());n(window).unbind("popstate."+this.app.eventNamespace());n(document).undelegate("a","click.history-"+this.app.eventNamespace());t.DefaultLocationProxy._bindings--;t.DefaultLocationProxy._bindings<=0&&(window.clearInterval(t.DefaultLocationProxy._interval),t.DefaultLocationProxy._interval=null)},getLocation:function(){return t.DefaultLocationProxy.fullPath(window.location)},setLocation:function(n){if(/^([^#\/]|$)/.test(n)&&(n=o&&!this.app.disable_push_state?"/"+n:"#!/"+n),n!=this.getLocation())if(o&&!this.app.disable_push_state&&/^\//.test(n))history.pushState({path:n},window.title,n),this.app.trigger("location-changed");else return window.location=n},_startPolling:function(i){var u=this,r;t.DefaultLocationProxy._interval||(i||(i=10),r=function(){var i=u.getLocation();(typeof t.DefaultLocationProxy._last_location=="undefined"||i!=t.DefaultLocationProxy._last_location)&&window.setTimeout(function(){n(window).trigger("hashchange",[!0])},0);t.DefaultLocationProxy._last_location=i},r(),t.DefaultLocationProxy._interval=window.setInterval(r,i))}}),t.Application=function(n){var r=this;this.routes={};this.listeners=new t.Object({});this.arounds=[];this.befores=[];this.namespace=(new Date).getTime()+"-"+parseInt(Math.random()*1e3,10);this.context_prototype=function(){t.EventContext.apply(this,arguments)};this.context_prototype.prototype=new t.EventContext;i(n)&&n.apply(this,[this]);this._location_proxy||this.setLocationProxy(new t.DefaultLocationProxy(this,this.run_interval_every));this.debug&&this.bindToAllEvents(function(n,t){r.log(r.toString(),n.cleaned_type,t||{})})},t.Application.prototype=n.extend({},t.Object.prototype,{ROUTE_VERBS:["get","post","put","delete"],APP_EVENTS:["run","unload","lookup-route","run-route","route-found","event-context-before","event-context-after","changed","error","check-form-submission","redirect","location-changed"],_last_route:null,_location_proxy:null,_running:!1,element_selector:"body",debug:!1,raise_errors:!1,run_interval_every:50,disable_push_state:!1,template_engine:null,toString:function(){return"Sammy.Application:"+this.element_selector},$element:function(t){return t?n(this.element_selector).find(t):n(this.element_selector)},use:function(){var u=r(arguments),n=u.shift(),f=n||"";try{u.unshift(this);typeof n=="string"&&(f="Sammy."+n,n=t[n]);n.apply(this,u)}catch(e){typeof n=="undefined"?this.error("Plugin Error: called use() but plugin ("+f.toString()+") is not defined",e):i(n)?this.error("Plugin Error",e):this.error("Plugin Error: called use() but '"+f.toString()+"' is not a function",e)}return this},setLocationProxy:function(n){var t=this._location_proxy;this._location_proxy=n;this.isRunning()&&(t&&t.unbind(),this._location_proxy.bind())},log:function(){t.log.apply(t,Array.prototype.concat.apply([this.element_selector],arguments))},route:function(t,r){var f=this,o=[],e,h,u=Array.prototype.slice.call(arguments,2);if(u.length===0&&i(r)&&(u=[r],r=t,t="any"),t=t.toLowerCase(),r.constructor==String){for(s.lastIndex=0;(h=s.exec(r))!==null;)o.push(h[1]);r=new RegExp(r.replace(s,p)+"$")}return n.each(u,function(n,t){typeof t=="string"&&(u[n]=f[t])}),e=function(n){var t={verb:n,path:r,callback:u,param_names:o};f.routes[n]=f.routes[n]||[];f.routes[n].push(t)},t==="any"?n.each(this.ROUTE_VERBS,function(n,t){e(t)}):e(t),this},get:f("get"),post:f("post"),put:f("put"),del:f("delete"),any:f("any"),mapRoutes:function(t){var i=this;return n.each(t,function(n,t){i.route.apply(i,t)}),this},eventNamespace:function(){return["sammy-app",this.namespace].join("-")},bind:function(n,t,i){var r=this,u;return typeof i=="undefined"&&(i=t),u=function(){var t,u,n;t=arguments[0];n=arguments[1];n&&n.context?(u=n.context,delete n.context):u=new r.context_prototype(r,"bind",t.type,n,t.target);t.cleaned_type=t.type.replace(r.eventNamespace(),"");i.apply(u,[t,n])},this.listeners[n]||(this.listeners[n]=[]),this.listeners[n].push(u),this.isRunning()&&this._listen(n,u),this},trigger:function(n,t){return this.$element().trigger([n,this.eventNamespace()].join("."),[t]),this},refresh:function(){return this.last_location=null,this.trigger("location-changed"),this},before:function(n,t){return i(n)&&(t=n,n={}),this.befores.push([n,t]),this},after:function(n){return this.bind("event-context-after",n)},around:function(n){return this.arounds.push(n),this},onComplete:function(n){return this._onComplete=n,this},isRunning:function(){return this._running},helpers:function(t){return n.extend(this.context_prototype.prototype,t),this},helper:function(n,t){return this.context_prototype.prototype[n]=t,this},run:function(i){if(this.isRunning())return!1;var r=this;return n.each(this.listeners.toHash(),function(t,i){n.each(i,function(n,i){r._listen(t,i)})}),this.trigger("run",{start_url:i}),this._running=!0,this.last_location=null,/\#(.+)/.test(this.getLocation())||typeof i=="undefined"||this.setLocation(i),this._checkLocation(),this._location_proxy.bind(),this.bind("location-changed",function(){r._checkLocation()}),this.bind("submit",function(i){if(!t.targetIsThisWindow(i,"form"))return!0;var u=r._checkFormSubmission(n(i.target).closest("form"));return u===!1?i.preventDefault():!1}),n(window).bind("unload",function(){r.unload()}),this.trigger("changed")},unload:function(){if(!this.isRunning())return!1;var t=this;return this.trigger("unload"),this._location_proxy.unbind(),this.$element().unbind("submit").removeClass(t.eventNamespace()),n.each(this.listeners.toHash(),function(i,r){n.each(r,function(n,r){t._unlisten(i,r)})}),this._running=!1,this},destroy:function(){return this.unload(),delete t.apps[this.element_selector],this},bindToAllEvents:function(t){var i=this;return n.each(this.APP_EVENTS,function(n,r){i.bind(r,t)}),n.each(this.listeners.keys(!0),function(r,u){n.inArray(u,i.APP_EVENTS)==-1&&i.bind(u,t)}),this},routablePath:function(n){return n.replace(c,"")},lookupRoute:function(n,t){var e=this,u=!1,i=0,f,r;if(typeof this.routes[n]!="undefined")for(f=this.routes[n].length;i<f;i++)if(r=this.routes[n][i],e.routablePath(t).match(r.path)){u=r;break}return u},runRoute:function(t,i,r,u){var s=this,f=this.lookupRoute(t,i),o,c,y,l,a,h,v,p;if(this.debug&&this.log("runRoute",[t,i].join(" ")),this.trigger("run-route",{verb:t,path:i,params:r}),typeof r=="undefined"&&(r={}),n.extend(r,this._parseQueryString(i)),f){this.trigger("route-found",{route:f});(v=f.path.exec(this.routablePath(i)))!==null&&(v.shift(),n.each(v,function(n,t){f.param_names[n]?r[f.param_names[n]]=e(t):(r.splat||(r.splat=[]),r.splat.push(e(t)))}));o=new this.context_prototype(this,t,i,r,u);y=this.arounds.slice(0);l=this.befores.slice(0);h=[o];r.splat&&(h=h.concat(r.splat));c=function(){for(var n,t,i;l.length>0;)if(a=l.shift(),s.contextMatchesOptions(o,a[0])&&(n=a[1].apply(o,[o]),n===!1))return!1;return s.last_route=f,o.trigger("event-context-before",{context:o}),typeof f.callback=="function"&&(f.callback=[f.callback]),f.callback&&f.callback.length&&(t=-1,i=function(){t++;f.callback[t]?n=f.callback[t].apply(o,h):s._onComplete&&typeof(s._onComplete==="function")&&s._onComplete(o)},h.push(i),i()),o.trigger("event-context-after",{context:o}),n};n.each(y.reverse(),function(n,t){var i=c;c=function(){return t.apply(o,[i])}});try{p=c()}catch(w){this.error(["500 Error",t,i].join(" "),w)}return p}return this.notFound(t,i)},contextMatchesOptions:function(t,i,r){var f=i,h,e,a,v,c,o,s;if((typeof f=="string"||l(f))&&(f={path:f}),typeof r=="undefined"&&(r=!0),n.isEmptyObject(f))return!0;if(u(f.path)){for(h=[],e=0,v=f.path.length;e<v;e+=1)a=n.extend({},f,{path:f.path[e]}),h.push(this.contextMatchesOptions(t,a));return c=n.inArray(!0,h)>-1?!0:!1,r?c:!c}return f.only?this.contextMatchesOptions(t,f.only,!0):f.except?this.contextMatchesOptions(t,f.except,!1):(o=!0,s=!0,f.path&&(l(f.path)||(f.path=new RegExp(f.path.toString()+"$")),o=f.path.test(t.path)),f.verb&&(s=typeof f.verb=="string"?f.verb===t.verb:f.verb.indexOf(t.verb)>-1),r?s&&o:!(s&&o))},getLocation:function(){return this._location_proxy.getLocation()},setLocation:function(n){return this._location_proxy.setLocation(n)},swap:function(n,t){var r=this.$element().html(n);return i(t)&&t(n),r},templateCache:function(n,t){return typeof t!="undefined"?h[n]=t:h[n]},clearTemplateCache:function(){return h={}},notFound:function(n,t){var i=this.error(["404 Not Found",n,t].join(" "));return n==="get"?i:!0},error:function(n,t){if(t||(t=new Error),t.message=[n,t.message].join(" "),this.trigger("error",{message:t.message,error:t}),this.raise_errors)throw t;else this.log(t.message,t)},_checkLocation:function(){var n,t;return n=this.getLocation(),this.last_location&&this.last_location[0]=="get"&&this.last_location[1]==n||(this.last_location=["get",n],t=this.runRoute("get",n)),t},_getFormVerb:function(t){var u=n(t),i,r;return r=u.find('input[name="_method"]'),r.length>0&&(i=r.val()),i||(i=u[0].getAttribute("method")),i&&i!==""||(i="get"),n.trim(i.toString().toLowerCase())},_checkFormSubmission:function(t){var i,r,f,u,e;return this.trigger("check-form-submission",{form:t}),i=n(t),r=i.attr("action")||"",f=this._getFormVerb(i),this.debug&&this.log("_checkFormSubmission",i,r,f),f==="get"?(u=this._serializeFormParams(i),u!==""&&(r+="?"+u),this.setLocation(r),e=!1):(u=n.extend({},this._parseFormParams(i)),e=this.runRoute(f,r,u,t.get(0))),typeof e=="undefined"?!1:e},_serializeFormParams:function(n){var r="",t=n.serializeArray(),i;if(t.length>0)for(r=this._encodeFormPair(t[0].name,t[0].value),i=1;i<t.length;i++)r=r+"&"+this._encodeFormPair(t[i].name,t[i].value);return r},_encodeFormPair:function(n,t){return a(n)+"="+a(t)},_parseFormParams:function(n){for(var i={},r=n.serializeArray(),t=0;t<r.length;t++)i=this._parseParamPair(i,r[t].name,r[t].value);return i},_parseQueryString:function(n){var r={},t,u,f,i;if(t=n.match(c),t&&t[1])for(u=t[1].split("&"),i=0;i<u.length;i++)f=u[i].split("="),r=this._parseParamPair(r,e(f[0]),e(f[1]||""));return r},_parseParamPair:function(n,t,i){return typeof n[t]!="undefined"?u(n[t])?n[t].push(i):n[t]=[n[t],i]:n[t]=i,n},_listen:function(n,t){return this.$element().bind([n,this.eventNamespace()].join("."),t)},_unlisten:function(n,t){return this.$element().unbind([n,this.eventNamespace()].join("."),t)}}),t.RenderContext=function(n){this.event_context=n;this.callbacks=[];this.previous_content=null;this.content=null;this.next_engine=!1;this.waiting=!1},t.RenderContext.prototype=n.extend({},t.Object.prototype,{then:function(n){var r,t;if(!i(n))if(typeof n=="string"&&n in this.event_context)r=this.event_context[n],n=function(n){return r.apply(this.event_context,[n])};else return this;return t=this,this.waiting?this.callbacks.push(n):(this.wait(),window.setTimeout(function(){var i=n.apply(t,[t.content,t.previous_content]);i!==!1&&t.next(i)},0)),this},wait:function(){this.waiting=!0},next:function(n){this.waiting=!1;typeof n!="undefined"&&(this.previous_content=this.content,this.content=n);this.callbacks.length>0&&this.then(this.callbacks.shift())},load:function(t,r,u){var f=this;return this.then(function(){var e,s,o;return(i(r)?(u=r,r={}):r=n.extend({},r),u&&this.then(u),typeof t=="string")?(o=t.match(/\.json(\?|$)/)||r.json,e=o?r.cache===!0:r.cache!==!1,f.next_engine=f.event_context.engineFor(t),delete r.cache,delete r.json,r.engine&&(f.next_engine=r.engine,delete r.engine),e&&(s=this.event_context.app.templateCache(t)))?s:(this.wait(),n.ajax(n.extend({url:t,data:{},dataType:o?"json":"text",type:"get",success:function(n){e&&f.event_context.app.templateCache(t,n);f.next(n)}},r)),!1):t.nodeType?t.innerHTML:t.selector?(f.next_engine=t.attr("data-engine"),r.clone===!1?t.remove()[0].innerHTML.toString():t[0].innerHTML.toString()):void 0})},loadPartials:function(n){var t;if(n){this.partials=this.partials||{};for(t in n)(function(t,i){t.load(n[i]).then(function(n){this.partials[i]=n})})(this,t)}return this},render:function(n,t,r,u){return i(n)&&!t?this.then(n):(i(t)?(u=r,r=t,t=null):r&&!i(r)&&(u=r,r=null),this.loadPartials(u).load(n).interpolate(t,n).then(r))},partial:function(n,t,r,u){return i(r)?this.render(n,t,u).swap(r):i(t)?this.render(n,{},r).swap(t):this.render(n,t,r).swap()},send:function(){var t=this,n=r(arguments),i=n.shift();return u(n[0])&&(n=n[0]),this.then(function(){return n.push(function(n){t.next(n)}),t.wait(),i.apply(i,n),!1})},collect:function(t,r,u){var e=this,f=function(){i(t)&&(r=t,t=this.content);var u=[],f=!1;return n.each(t,function(n,t){var i=r.apply(e,[n,t]);return i.jquery&&i.length==1&&(i=i[0],f=!0),u.push(i),i}),f?u:u.join("")};return u?f():this.then(f)},renderEach:function(t,i,r,f){return u(i)&&(f=r,r=i,i=null),this.load(t).then(function(e){var o=this;if(r||(r=u(this.previous_content)?this.previous_content:[]),f)n.each(r,function(n,r){var u={},s=this.next_engine||t;i?u[i]=r:u=r;f(r,o.event_context.interpolate(e,u,s))});else return this.collect(r,function(n,r){var u={},f=this.next_engine||t;return i?u[i]=r:u=r,this.event_context.interpolate(e,u,f)},!0)})},interpolate:function(n,t,i){var r=this;return this.then(function(u,f){!n&&f&&(n=f);this.next_engine&&(t=this.next_engine,this.next_engine=!1);var e=r.event_context.interpolate(u,n,t,this.partials);return i?f+e:e})},swap:function(n){return this.then(function(t){return this.event_context.swap(t,n),t}).trigger("changed",{})},appendTo:function(t){return this.then(function(i){n(t).append(i)}).trigger("changed",{})},prependTo:function(t){return this.then(function(i){n(t).prepend(i)}).trigger("changed",{})},replace:function(t){return this.then(function(i){n(t).html(i)}).trigger("changed",{})},trigger:function(n,t){return this.then(function(i){return typeof t=="undefined"&&(t={content:i}),this.event_context.trigger(n,t),i})}}),t.EventContext=function(n,i,r,u,f){this.app=n;this.verb=i;this.path=r;this.params=new t.Object(u);this.target=f},t.EventContext.prototype=n.extend({},t.Object.prototype,{$element:function(){return this.app.$element(r(arguments).shift())},engineFor:function(n){var t=this,r;return i(n)?n:(n=(n||t.app.template_engine).toString(),(r=n.match(/\.([^\.\?\#]+)(\?|$)/))&&(n=r[1]),n&&i(t[n]))?t[n]:t.app.template_engine?this.engineFor(t.app.template_engine):function(n){return n}},interpolate:function(n,t,i,r){return this.engineFor(i).apply(this,[n,t,r])},render:function(n,i,r,u){return new t.RenderContext(this).render(n,i,r,u)},renderEach:function(n,i,r,u){return new t.RenderContext(this).renderEach(n,i,r,u)},load:function(n,i,r){return new t.RenderContext(this).load(n,i,r)},loadPartials:function(n){return new t.RenderContext(this).loadPartials(n)},partial:function(n,i,r,u){return new t.RenderContext(this).partial(n,i,r,u)},send:function(){var n=new t.RenderContext(this);return n.send.apply(n,arguments)},redirect:function(){var t,i=r(arguments),l=this.app.getLocation(),o=i.length,e;if(o>1){for(var u=0,s=[],h=[],f={},c=!1;u<o;u++)typeof i[u]=="string"?s.push(i[u]):(n.extend(f,i[u]),c=!0);if(t=s.join("/"),c){for(e in f)h.push(this.app._encodeFormPair(e,f[e]));t+="?"+h.join("&")}}else t=i[0];this.trigger("redirect",{to:t});this.app.last_location=[this.verb,this.path];this.app.setLocation(t);new RegExp(t).test(l)&&this.app.trigger("location-changed")},trigger:function(n,t){return typeof t=="undefined"&&(t={}),t.context||(t.context=this),this.app.trigger(n,t)},eventNamespace:function(){return this.app.eventNamespace()},swap:function(n,t){return this.app.swap(n,t)},notFound:function(){return this.app.notFound(this.verb,this.path)},json:function(t){return n.parseJSON(t)},toString:function(){return"Sammy.EventContext: "+[this.verb,this.path,this.params].join(" ")}}),t}),function(n,t){var i=/[<>&\r\n"']/gm,r={"<":"lt;",">":"gt;","&":"amp;","\r":"#13;","\n":"#10;",'"':"quot;","'":"#39;"};n.extend({fileDownload:function(u,f){function it(){var i=e.cookieValue,v,f,t,r,h;if(typeof i=="string"&&(i=i.toLowerCase()),v=e.cookieName.toLowerCase()+"="+i,document.cookie.toLowerCase().indexOf(v)>-1){l.onSuccess(u);f=e.cookieName+"=; path="+e.cookiePath+"; expires="+new Date(0).toUTCString()+";";e.cookieDomain&&(f+=" domain="+e.cookieDomain+";");document.cookie=f;k(!1);return}if(o||c)try{if(t=o?o.document:rt(c),t&&t.body!==null&&t.body.innerHTML.length){if(r=!0,s&&s.length){h=n(t.body).contents().first();try{h.length&&h[0]===s[0]&&(r=!1)}catch(a){if(a&&a.number==-2146828218)r=!0;else throw a;}}if(r){setTimeout(function(){l.onFail(t.body.innerHTML,u);k(!0)},100);return}}}catch(y){l.onFail("",u,y);k(!0);return}setTimeout(it,e.checkInterval)}function rt(n){var t=n[0].contentWindow||n[0].contentDocument;return t.document&&(t=t.document),t}function k(n){setTimeout(function(){o&&(p&&o.close(),y&&o.focus&&(o.focus(),n&&o.close()))},0)}function ut(n){return n.replace(i,function(n){return"&"+r[n]})}var e=n.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},prepareCallback:function(){},successCallback:function(){},failCallback:function(){},httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",cookieDomain:null,popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},f),a=new n.Deferred,v=(navigator.userAgent||navigator.vendor||t.opera).toLowerCase(),y,p,d,g,h,l,c,o,w,s,tt,b,nt;if(/ip(ad|hone|od)/.test(v)?y=!0:v.indexOf("android")!==-1?p=!0:d=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(v)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(v.substr(0,4)),g=e.httpMethod.toUpperCase(),p&&g!=="GET"&&e.androidPostUnsupportedMessageHtml)return n().dialog?n("<div>").html(e.androidPostUnsupportedMessageHtml).dialog(e.dialogOptions):alert(e.androidPostUnsupportedMessageHtml),a.reject();h=null;l={onPrepare:function(t){e.preparingMessageHtml?h=n("<div>").html(e.preparingMessageHtml).dialog(e.dialogOptions):e.prepareCallback&&e.prepareCallback(t)},onSuccess:function(n){h&&h.dialog("close");e.successCallback(n);a.resolve(n)},onFail:function(t,i,r){h&&h.dialog("close");e.failMessageHtml&&n("<div>").html(e.failMessageHtml).dialog(e.dialogOptions);e.failCallback(t,i,r);a.reject(t,i)}};l.onPrepare(u);return e.data!==null&&typeof e.data!="string"&&(e.data=n.param(e.data)),g==="GET"?(e.data!==null&&(tt=u.indexOf("?"),tt!==-1?u.substring(u.length-1)!=="&"&&(u=u+"&"):u=u+"?",u=u+e.data),y||p?(o=t.open(u),o.document.title=e.popupWindowTitle,t.focus()):d?t.location(u):c=n("<iframe>").hide().prop("src",u).appendTo("body")):(b="",e.data!==null&&n.each(e.data.replace(/\+/g," ").split("&"),function(){var n=this.split("="),u=n[0],i,t,r;n.shift();i=n.join("=");n=[u,i];t=e.encodeHTMLEntities?ut(decodeURIComponent(n[0])):decodeURIComponent(n[0]);t&&(r=e.encodeHTMLEntities?ut(decodeURIComponent(n[1])):decodeURIComponent(n[1]),b+='<input type="hidden" name="'+t+'" value="'+r+'" />')}),d?(s=n("<form>").appendTo("body"),s.hide().prop("method",e.httpMethod).prop("action",u).html(b)):(y?(o=t.open("about:blank"),o.document.title=e.popupWindowTitle,w=o.document,t.focus()):(c=n("<iframe style='display: none' src='about:blank'><\/iframe>").appendTo("body"),w=rt(c)),w.write("<html><head><\/head><body><form method='"+e.httpMethod+"' action='"+u+"'>"+b+"<\/form>"+e.popupWindowTitle+"<\/body><\/html>"),s=n(w).find("form")),s.submit()),setTimeout(it,e.checkInterval),nt=a.promise(),nt.abort=function(){k();c.remove()},nt}})}(jQuery,this);ko.bindingHandlers.slideVisible={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).slideDown():$(n).slideUp()}};ko.bindingHandlers.slideLateral={init:function(n,t){var i=t();$(n).toggle(ko.unwrap(i))},update:function(n,t){var i=t();ko.unwrap(i)?$(n).show("slide",{direction:"right"},1e3):$(n).hide("slide",{direction:"left"},1e3)}};ko.bindingHandlers.numericText={init:function(n,t){ko.utils.registerEventHandler(n,"keypress",function(n){var t=onlyRealNumbersChars(n);t||n.preventDefault()});ko.utils.registerEventHandler(n,"change",function(n){var i=t(),r=n.target.value;i(r)})},update:function(n,t){var r=ko.isObservable(t())?t()():t(),i;App.Core.IsNullOrUndefined(r)?(t()(null),n.value=""):(i=App.Core.ParseNumber(r),isNaN(i)?(t()(null),n.value=""):(i=Math.round(i*100)/100,ko.isObservable(t())&&t()(i),typeof n.type=="undefined"?n.innerHTML=App.Core.FormatNumber(i):n.value=App.Core.FormatNumber(i)))}};ko.bindingHandlers.numeric={init:function(n){$(n).on("keydown",function(n){n.keyCode==46||n.keyCode==8||n.keyCode==9||n.keyCode==27||n.keyCode==13||n.keyCode==65&&n.ctrlKey===!0||n.keyCode==116||n.keyCode>=35&&n.keyCode<=39||(n.shiftKey||(n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105))&&n.preventDefault()})}};ko.bindingHandlers.valueAsInt={init:function(n,t){var i=t(),r=ko.computed({read:function(){var n=ko.utils.unwrapObservable(i);return i()?i().toString():i()},write:function(n){i(n?parseInt(n,10):undefined)},owner:this});ko.applyBindingsToNode(n,{value:r})}};ko.bindingHandlers.numericTextSeparator={init:function(n,t){ko.utils.registerEventHandler(n,"keypress",function(n){var t=onlyRealNumbersChars(n);t||n.preventDefault()});ko.utils.registerEventHandler(n,"change",function(n){var i=t(),r=n.target.value;i(r)})},update:function(n,t){var r=ko.isObservable(t())?t()():t(),i;App.Core.IsNullOrUndefined(r)?n.value="":(i=App.Core.ParseNumber(r),isNaN(i)?(t()(null),n.value=""):(i=Math.round(i*100)/100,ko.isObservable(t())&&t()(i),typeof n.type=="undefined"?n.innerHTML=App.Core.FormatNumberSeparation(i):n.value=App.Core.FormatNumberSeparation(i)))}};ko.bindingHandlers.dateText={init:function(n,t){ko.utils.registerEventHandler(n,"change",function(){var i=t(),r=App.Core.IsNullOrEmpty(n.value)?"":App.Core.ParseDate(n.value.trim());i(r)})},update:function(n,t){var i=ko.isObservable(t())?t()():t(),r=App.Core.IsNullOrUndefined(i)||i==""?"":App.Core.FormatDate(i);typeof n.type=="undefined"||n.type===""?n.innerHTML=r:n.value=r}};ko.bindingHandlers.dateTimeText={init:function(n,t){ko.utils.registerEventHandler(n,"change",function(){var i=t(),r=App.Core.IsNullOrEmpty(n.value)?"":App.Core.ParseDateTimeFormatted(n.value.trim(),"DD/MM/YYYY HH:mm","DD/MM/YY HH:mm");i(r)})},update:function(n,t){var i=ko.isObservable(t())?t()():t(),r=App.Core.IsNullOrUndefined(i)?"":moment(i).format("DD/MM/YYYY HH:mm");typeof n.type=="undefined"||n.type===""?n.innerHTML=r:n.value=r}};ko.bindingHandlers.dateTime2Text={init:function(n,t){ko.utils.registerEventHandler(n,"change",function(){var i=t(),r=App.Core.IsNullOrEmpty(n.value)?"":App.Core.ParseDateTimeFormatted(n.value.trim(),"DD/MM/YYYY HH:mm:ss","DD/MM/YY HH:mm:ss");i(r)})},update:function(n,t){var i=ko.isObservable(t())?t()():t(),r=App.Core.IsNullOrUndefined(i)?"":moment(i).format("DD/MM/YYYY HH:mm:ss");typeof n.type=="undefined"||n.type===""?n.innerHTML=r:n.value=r}};ko.bindingHandlers.uniqueId={init:function(n,t){var i=t(),r=i.id||ko.bindingHandlers.uniqueId.prefix+ ++ko.bindingHandlers.uniqueId.counter;n.id=r;i(r)},counter:0,prefix:"ko_unique_"};ko.bindingHandlers.enableChildren={update:function(n,t){var i=ko.utils.unwrapObservable(t());i&&n.disabled?(n.removeAttribute("disabled"),$(n).find("*").removeAttr("disabled")):i||n.disabled||(n.disabled=!0,$(n).find("*").attr("disabled","disabled"))}};ko.bindingHandlers.disableChildren={update:function(n,t){ko.bindingHandlers.enableChildren.update(n,function(){return!ko.utils.unwrapObservable(t())})}};ko.bindingHandlers.cbiText={init:function(n,t){ko.utils.registerEventHandler(n,"keypress",function(n){cbiValidation(n)||n.preventDefault()});ko.utils.registerEventHandler(n,"change",function(n){var i=t(),r=n.target.value;i(r)})},update:function(n,t){var i=ko.isObservable(t())?t()():t();typeof n.type=="undefined"||n.type===""?n.innerHTML=i:n.value=i}};ko.bindingHandlers.uppercaseText={init:function(n,t){ko.utils.registerEventHandler(n,"keyup",function(n){var i=t(),r=n.target.value;i(r)});var i=t(),r=ko.computed({read:function(){var n=ko.utils.unwrapObservable(i);return i()?i().toString():i()},write:function(n){i(n?n.toUpperCase():"")},owner:this});ko.applyBindingsToNode(n,{value:r})},update:function(n,t){var r=ko.isObservable(t())?t()():t(),u,f,i;n.tagName=="INPUT"&&(u=n.selectionStart,f=n.selectionEnd);App.Core.IsNullOrUndefined(r)?(t()(null),n.value=""):(i=r.toUpperCase(),ko.isObservable(t())&&t()(i),typeof n.type=="undefined"?n.innerHTML=i:n.value=i,n.tagName=="INPUT"&&n.setSelectionRange(u,f))}};var _getRealValue=function(n){return ko.isObservable(n)?n():n},_getValueByKey=function(n,t){if(t.indexOf(".")!=-1){var r=t.split("."),i="";return r.forEach(function(t){i=i?_getRealValue(i[t]):_getRealValue(n[t])}),i}return _getRealValue(n[t])},_arrayGetDistinctPropertyValues=function(n,t){return n=n||[],t=t||0,ko.utils.arrayGetDistinctValues(ko.utils.arrayMap(n,function(n){return _getRealValue(n[t])}))},_arrayGetDistinctValuesBy=function(n,t){n=n||[];t=t||0;var i=[],r=_arrayGetDistinctPropertyValues(n,t);return ko.utils.arrayForEach(r,function(r){i.push(ko.utils.arrayFirst(n,function(n){return _getRealValue(n[t])===r}))}),i},_arrayGroupBy=function(n,t){var i={},r=ko.toJS(n);return ko.utils.arrayForEach(r,function(n){var r=ko.toJSON(t(n));i[r]=i[r]||[];i[r].push(n)}),Object.keys(i).map(function(n){return i[n]})},_arraySum=function(n,t){var u=ko.toJS(n),r,i;for(typeof t!="function"&&(t=function(n){return n}),r=0,i=0;i<u.length;i++)r+=parseFloat(t(u[i]));return r},_arrayCount=function(){var n=0,t=this();return t&&(n=t.length),n},_getResource=function(n){return _getValueByKey(Resources,n)};ko.utils.arrayGetDistinctPropertyValues=_arrayGetDistinctPropertyValues;ko.utils.arrayGetDistinctValuesBy=_arrayGetDistinctValuesBy;ko.utils.arrayGroupBy=_arrayGroupBy;ko.utils.arraySum=_arraySum;ko.utils.getValueByKey=_getValueByKey;ko.utils.GetResource=_getResource;ko.observableArray.fn.count=_arrayCount;PropertySelector=function(n,t){for(var i=t.split("."),r=n[i[0]],u=1;u<i.length;u++)r=r[i[u]];return r};ko.observableArray.fn.sortAscProperty=function(n){this.sort(function(t,i){return PropertySelector(t,n)>=PropertySelector(i,n)?1:-1})};ko.observableArray.fn.sortDescProperty=function(n){this.sort(function(t,i){return PropertySelector(t,n)<=PropertySelector(i,n)?1:-1})};ko.observableArray.fn.sortAscObservableProperty=function(n){this.sort(function(t,i){return PropertySelector(t,n)()>=PropertySelector(i,n)()?1:-1})};ko.observableArray.fn.sortDescObservableProperty=function(n){this.sort(function(t,i){return PropertySelector(t,n)()<=PropertySelector(i,n)()?1:-1})},function(n){(function(t){t.PagedObservableArray=function(n){n=n||{};var u=ko.observableArray(n.allData||[]),f=ko.observable(n.pageSize||10),a=n.pageSizeDropDown||[],h=ko.observable(n.cercaText||""),r=ko.observable(n.currentSort||""),i=ko.observable(n.currentSortIsAsc||!0),t=ko.observable(1),e=ko.observable(1),v=ko.computed(function(){var i=h().toLowerCase(),n=ko.toJS(u)||[];i&&(t(1),n=ko.utils.arrayFilter(n,function(n){var t=!1,r=function(n){$.each(n,function(n,i){if(t)return!1;i!==null&&typeof i=="object"?r(i):t=u(i)})},u=function(n){var t="",r;try{t=(typeof n=="function"?n():n)||""}catch(u){console.log(u)}return r=t instanceof Date?moment(t).format("DD/MM/YYYY"):t.toString(),r.toLowerCase().indexOf(i)>-1};return r(n),t}));var r=f(),o=t()-1,s=r*o,c=r*(o+1);return e(Math.ceil(n.length/f())||1),n.slice(s,c)},this),y=function(){t()<e()&&t(t()+1)},p=function(){t()>1&&t(t()-1)},w=function(){t(1)},b=function(){t(e())},k=function(n){n==r()?(i()?c(n):o(n),i(!i())):(i(!0),o(n));r(n)},d=function(n){n==r()?(i()?l(n):s(n),i(!i())):(i(!0),s(n));r(n)},g=function(n,t){n==r()?i()?o(n):c(n):(i(t),o(n));r(n)},nt=function(n,t){n==r()?i()?s(n):l(n):(i(t),s(n));r(n)},o=function(n){u.sortAscObservableProperty(n)},c=function(n){u.sortDescObservableProperty(n)},s=function(n){u.sortAscProperty(n)},l=function(n){u.sortDescProperty(n)};_goToPage=function(n){t(n)};f.subscribe(function(){t(-1);t(1)});n.currentSortIsAsc&&n.currentSort&&(o(n.currentSort),e(Math.ceil(u().length/f())||1));this.AllData=u;this.PageSize=f;this.PageSizeDropDown=a;this.CercaText=h;this.PageIndex=t;this.GoToPage=_goToPage;this.Page=v;this.PageCount=e;this.NextPage=y;this.PreviousPage=p;this.FirstPage=w;this.LastPage=b;this.SortToggleObservable=k;this.SortToggle=d;this.SortObservable=g;this.Sort=nt;this.CurrentSort=r();this.ThCss=function(n){return r()==n?i()?"sorting_asc":"sorting_desc":"sorting"}};t.PagedArrayAsync=function(t){t=t||{};var nt=t.self,l=t.searchUrl||"",e=t.mappingResponse||null,h=t.searchCallback||$.noop,i=ko.mapping.fromJS(t.pagingFilter,null,i),o=ko.observable(i.Size()),a=function(){o()!=null&&o()!==i.Size()?i.StartIndex(1):i.StartIndex(i.StartIndex()||1);i.Size(i.Size()||10);i.SortColumn(i.SortColumn()||"1");i.IsSortAscending(i.IsSortAscending()===null?!1:i.IsSortAscending())},u=ko.observableArray([]),c=ko.observableArray([]),s=ko.observable(0),v=t.pageSizeDropDown||[10,20,50,100],r=function(){a();Http.Post(l,ko.mapping.toJSON(i)).success(function(t){var r=new n.Core.SearchJsonResult(t);ko.mapping.fromJS(r.PagingFilter,null,i);r.HasError&&ko.mapping.fromJS(r.Messages,null,c);s(r.TotaleElementi);o(i.Size());e!==null?(u([]),ko.utils.arrayForEach(r.Response||[],function(n){u.push(new e(n))})):ko.mapping.fromJS(r.Response||[],null,u);f(Math.ceil(s()/i.Size())||1);h(r)})},f=ko.observable(1),y=function(n){return i.SortColumn()==n?i.IsSortAscending()?"sorting_asc":"sorting_desc":"sorting"},p=function(){i.StartIndex()<f()&&(i.StartIndex(i.StartIndex()+1),r())},w=function(){i.StartIndex()>1&&(i.StartIndex(i.StartIndex()-1),r())},b=function(){i.StartIndex(1);r()},k=function(){i.StartIndex(f());r()},d=function(n){return function(){i.SortColumn()===n?i.IsSortAscending(!i.IsSortAscending()):i.IsSortAscending(!0);i.SortColumn(n||"1");i.StartIndex(1);r()}},g=function(){i.StartIndex(1);r()};_goToPage=function(n){i.StartIndex(n);r()};this.PagingFilter=i;this.PageSizeDropDown=v;this.MappingResponse=e;this.Page=u;this.Search=g;this.SearchCallback=h;this.Validation=c;this.PageCount=f;this.PageIndex=i.StartIndex;this.GoToPage=_goToPage;this.ThCss=y;this.NextPage=p;this.PreviousPage=w;this.FirstPage=b;this.LastPage=k;this.SortToggle=d;this.TotaleElementi=s}})(n.Core||(n.Core={}));var t=n.Core}(App||(App={})),function(n){typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?n(require("knockout"),exports):typeof define=="function"&&define.amd?define(["knockout","exports"],n):n(ko,ko.postbox={})}(function(n,t,i){var u,e,r={},f=1;t.subscriptions=r;n.subscribable.call(t);t.topicCache={};t.serializer=n.toJSON;t.publish=function(n,i){n&&(t.topicCache[n]={value:i,serialized:t.serializer(i)},t.notifySubscribers(i,n))};e=t.subscribe;t.subscribe=function(n,u,o,s){var h,c,l;if(n)return typeof o=="boolean"&&(s=o,o=i),h=e.call(t,u,o,n),h.subId=++f,r[f]=h,s&&(c=t.topicCache[n],c!==i&&u.call(o,c.value)),l=h.dispose,h.dispose=function(){delete r[h.subId];l.call(h)},h};t.reset=function(){var n;for(var i in r)r.hasOwnProperty(i)&&(n=r[i],n&&typeof n.dispose=="function"&&n.dispose());t.topicCache={}};t.defaultComparer=function(n,i){return i&&t.serializer(n)===i.serialized};n.subscribable.fn.publishOn=function(n,i,e){var s,o,h;return n&&(typeof i=="function"?e=i:s=i,e=e||t.defaultComparer,u.call(this,n,"publishOn"),o=this.subscribe(function(i){e.call(this,i,t.topicCache[n])||t.publish(n,i)},this),o.id=++f,r[f]=o,h=o.dispose,o.dispose=function(){delete this.postboxSubs[n].publishOn;delete r[o.id];h.call(o)}.bind(this),this.postboxSubs[n].publishOn=o,s||t.publish(n,this())),this};u=function(n,t){var i=this.postboxSubs=this.postboxSubs||{};i[n]=i[n]||{};i[n][t]&&i[n][t].dispose()};n.subscribable.fn.stopPublishingOn=function(n){return u.call(this,n,"publishOn"),this};n.subscribable.fn.subscribeTo=function(r,f,e){var c,s,h,o,l,a=this;return typeof f=="function"?e=f:c=f,r&&n.isWriteableObservable(this)&&(u.call(this,r,"subscribeTo"),h=function(n){a(e?e.call(a,n):n)},o=t.subscribe(r,h),this.postboxSubs[r].subscribeTo=o,l=o.dispose,o.dispose=function(){delete this.postboxSubs[r].subscribeTo;l.call(o)}.bind(this),c&&(s=t.topicCache[r],s!==i&&h(s.value))),this};n.subscribable.fn.unsubscribeFrom=function(n){return u.call(this,n,"subscribeTo"),this};n.subscribable.fn.syncWith=function(n,t,i,r){return this.subscribeTo(n,t).publishOn(n,i,r),this};n.postbox=t}),function(n){(function(n){var t=function(n){return function(){return n()?"icon-replace icon-collapse active":"icon-replace icon-expand active"}},i=function(n){$(n).html("")};n.CssCollapse=t;n.CleanSpalla=i})(n.Core||(n.Core={}));var t=n.Core}(App||(App={}));$(function(){$.widget("et.PagedList",$.tm.itemSelectorPage,{_validation:ko.observableArray([]),_init:function(){this._super();var n=this;$("thead > tr > th",this.element).each(function(t,i){$(i).hasClass("dt-nosort")||($(i).removeClass(),$(i).attr("dt-sortColumn")==n.options.param.pagingFilter.SortColumn()&&n._orderClass($("th[dt-sortColumn='"+n.options.param.pagingFilter.SortColumn()+"']",n.element)))});$("thead > tr > th",n.element).unbind();$("thead > tr > th",n.element).not("thead > tr > th.dt-nosort",n.element).click(function(t){t.preventDefault();n._sort($(t.currentTarget));n.options.param.pagingFilter.StartIndex(1);n._popolaTabella(!1)})},_sort:function(n){var t=this;n.attr("dt-sortColumn")&&(n.attr("dt-sortColumn")!=t.options.param.pagingFilter.SortColumn()?(t.options.param.pagingFilter.IsSortAscending(!0),t._orderClass($("th[dt-sortColumn='"+t.options.param.pagingFilter.SortColumn()+"']",t.element),"sorting")):t.options.param.pagingFilter.IsSortAscending(!t.options.param.pagingFilter.IsSortAscending()),t.options.param.pagingFilter.SortColumn(n.attr("dt-sortColumn")),t._orderClass(n))},_orderClass:function(n,t){n.removeClass();t?n.addClass(t):this.options.param.pagingFilter.IsSortAscending()?n.addClass("sorting_asc"):n.addClass("sorting_desc")},_format_date:function(n){return App.Core.FormatDate(n.trim())},_format_import:function(n){var t=App.Core.ParseNumber(parseFloat(n));return isNaN(t)?"":App.Core.FormatNumberSeparation(Math.round(t*100)/100)},_clearTable:function(){$("tbody",this.element).html("")},_getData:function(n){var t=this;Http.Post(this.options.param.dataSourceUrl,ko.mapping.toJSON(t.options.param.pagingFilter)).success(function(i){var r=new App.Core.SearchJsonResult(i);t.options.param.pagingFilter=ko.mapping.fromJS(r.PagingFilter,null,t.options.param.pagingFilter);r.HasError?ko.mapping.fromJS(r.Messages,null,t.options.param.validation):(t._clearTable(),r.Response&&n(r));t._trigger("complete",null)})},_initPostPopulate:function(){this._super();this.element.DataTable().page.len(10).draw()},_drawRows:function(n){var t=this;$.each(n,function(n,i){var r=$("<tr><\/tr>"),u=$("tbody",t.element);$.each($("thead > tr > th",t.element),function(n,u){var o=$("<td><\/td>"),g=$(u).attr("dt-cssClass"),l,a,f,s,v,y,h,nt,e,p,w,b,c,k,d;g&&o.addClass(g);l=$(u).attr("dt-fixedValue");l?o.text(l):(a=$(u).attr("dt-columnProperty"),a&&(f=ko.utils.getValueByKey(i,a),s=$("<span><\/span>"),f!==null&&f!==undefined?(v=$(u).attr("dt-dataType"),v&&(f=t["_format_"+v](f)),y=$(u).attr("dt-resource"),y&&(resource=y+"."+f,f=ko.utils.GetResource(resource)),h=$(u).attr("dt-clickable"),h&&(nt=["=","<",">","!="],e="",$.each(nt,function(n,t){if(h.indexOf(t)>=0){e=t;return}}),e?(p=h.split(e),e=ko.utils.getValueByKey(i,p[0])+e+p[1],eval(e)&&(s=$("<a><\/a>").css("cursor","pointer").click(function(n){return function(){t.options.param.detailCallback(n)}}(i)))):s=$("<a><\/a>").css("cursor","pointer").click(function(n){return function(){t.options.param.detailCallback(n)}}(i))),w=$(u).attr("dt-fixedPostValue"),w&&(f+=" "+w),b=$(u).attr("dt-postValue"),b&&(c=ko.utils.getValueByKey(i,b),c!==undefined&&c!==null&&(f+=" "+c)),k=$(u).attr("dt-drawImageCallback"),k&&(eval(k)(o,f),f="")):f="",d=$(u).attr("dt-negativeValueColor"),d&&f[0]=="-"&&o.css({color:d}),s.text(f),o.append(s)));r.append(o)});u.append(r)})},_drawPaginator:function(n){var o=$(this.element),e=Math.ceil(n/this.options.param.pagingFilter.Size()),f=$("<div><\/div>").attr("id",o.attr("id")+"_paginator").addClass("dataTables_paginate"),u=$("<span><\/span>"),i=this,r,t;if(e>i.options.param.maxPages)if(i.options.param.pagingFilter.StartIndex()<i.options.param.maxPages){for(r=1;r<=i.options.param.maxPages;r++)t=$("<a>"+r+"<\/a>").addClass("paginate_button"),r==i.options.param.pagingFilter.StartIndex()?t.addClass("current"):(t.unbind(),t.click(function(n){return function(){i.options.param.pagingFilter.StartIndex(n);i._popolaTabella(!1)}}(r))),u.append(t);f.append(u);f.append($('<span><a class="paginate_ellipsis">...<\/a><\/span>'));u=$("<span><\/span>");t=$("<a>"+e+"<\/a>").addClass("paginate_button");t.click(function(){i.options.param.pagingFilter.StartIndex(e);i._popolaTabella(!1)});u.append(t);f.append(u)}else if(i.options.param.pagingFilter.StartIndex()>=i.options.param.maxPages&&i.options.param.pagingFilter.StartIndex()<e-2){for(u=$("<span><\/span>"),t=$("<a>1<\/a>").addClass("paginate_button"),t.click(function(){i.options.param.pagingFilter.StartIndex(1);i._popolaTabella(!1)}),u.append(t),f.append(u),f.append($('<span><a class="paginate_ellipsis">...<\/a><\/span>')),u=$("<span><\/span>"),r=i.options.param.pagingFilter.StartIndex()-1;r<=i.options.param.pagingFilter.StartIndex()+1;r++)t=$("<a>"+r+"<\/a>").addClass("paginate_button"),r==i.options.param.pagingFilter.StartIndex()?t.addClass("current"):(t.unbind(),t.click(function(n){return function(){i.options.param.pagingFilter.StartIndex(n);i._popolaTabella(!1)}}(r))),u.append(t);f.append(u);f.append($('<span><a class="paginate_ellipsis">...<\/a><\/span>'));u=$("<span><\/span>");t=$("<a>"+e+"<\/a>").addClass("paginate_button");t.click(function(){i.options.param.pagingFilter.StartIndex(e);i._popolaTabella(!1)});u.append(t);f.append(u)}else{for(u=$("<span><\/span>"),t=$("<a>1<\/a>").addClass("paginate_button"),t.click(function(){i.options.param.pagingFilter.StartIndex(1);i._popolaTabella(!1)}),u.append(t),f.append(u),f.append($('<span><a class="paginate_ellipsis">...<\/a><\/span>')),u=$("<span><\/span>"),r=i.options.param.pagingFilter.StartIndex()-4;r<=e;r++)t=$("<a>"+r+"<\/a>").addClass("paginate_button"),r==i.options.param.pagingFilter.StartIndex()?t.addClass("current"):(t.unbind(),t.click(function(n){return function(){i.options.param.pagingFilter.StartIndex(n);i._popolaTabella(!1)}}(r))),u.append(t);f.append(u)}else{for(r=1;r<=e;r++)t=$("<a>"+r+"<\/a>").addClass("paginate_button"),r==i.options.param.pagingFilter.StartIndex()?t.addClass("current"):(t.unbind(),t.click(function(n){return function(){i.options.param.pagingFilter.StartIndex();i.options.param.pagingFilter.StartIndex(n);i._popolaTabella(!1)}}(r))),u.append(t);f.append(u)}o.after(f)},_popolaTabella:function(n){var t=this;t._getData(function(i){t._drawRows(i.Response);$("#"+t.element.attr("id")+"_paginator").html("");i.TotaleElementi>t.options.param.pagingFilter.Size()&&t._drawPaginator(i.TotaleElementi);t._orderClass($("th[dt-sortColumn='"+t.options.param.pagingFilter.SortColumn()+"']",t.element));n===undefined&&(n=null);(n||n==null)&&t._initPostPopulate(i.Response);$("thead > tr > th.sorting_disabled",t.element).not("thead > tr > th.dt-nosort",t.element).removeClass("sorting_disabled").addClass("sorting")})}})});