<div id="mainContentCarte">
<div class="ripetiPagamento riquadro"><div><div class="section"><h3 class="titleSection">Ripeti ricarica</h3><div id="ripeti" class="ripetiMobile pull-right visible-xs isMobile" onclick="mostraNuovaRicarica(true);">Nuovo</div>















	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">06/10/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">12,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7279051242">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="12">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">06/10/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">12,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7279051237">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="12">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">06/10/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">123,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7279051236">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="123">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">26/09/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">765,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7269051181">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="765">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">21/09/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">10,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7264051166">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="10">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">14/09/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">554,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7257051134">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="554">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">08/09/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">45,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7251051108">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="45">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">06/09/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580393420324</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">4,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7249051091">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="4">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580393420324">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">16/08/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">63,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7228051022">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="63">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>

	
	
	
	<form id="ripetiRicaricaForm" method="post" action="/WEBHB/cartaConto/ricaricaCartaDati.do" style="margin-top:40px"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="222c2b402b33d4d7364b2cfb5ca6a97f"></div>		
		<div class="table-responsive">
			<table class="" style="width: 100%;">
				<tbody>
					<tr>
						<td>Data</td>
						<td class="bold oRight">09/08/2017</td>
						<td class=" txt_center vertical_center" rowspan="4"><input type="submit" name="ripetiRicarica" value="Submit" class="ripetiButton" title="ripeti ricarica"></td>
					</tr>
					<tr>
						<td>Rapporto</td>
						<td class="bold oRight">00003610</td>
					</tr>
					<tr>
						<td>Numero carta</td>
						<td class="bold oRight">005400580890016534</td>
					</tr>
					<tr>
						<td>Importo</td>
						<td class="bold oRight">25,00 </td>
					</tr>
				</tbody>
			</table>
		</div>
		<input type="hidden" name="codOperazione" value="IH7221050968">
		<input type="hidden" name="codContoCorrente" value="001|2001|200100003610">
		<input type="hidden" name="importo" value="25">
		<input type="hidden" name="importoDec" value="00">
		<input type="hidden" name="beneficiarioCarta" value="5400580890016534">
		<input type="hidden" name="beneficiarioTipologia" value="NOVALUE">
		<input type="hidden" name="codCarta" value="000000000000">
		<input type="hidden" name="page" value="ripetiRicarica">
		
	</form>




</div></div></div>
</div>




					<div class="visible-print-block"> 
						<img src="/HT/IMAGES/nGrafica/logo.png" title="Torna all'homepage" alt="Torna all'homepage">
						<div class="pull-right">
							  
							10/03/2017	
						</div>
					</div>
					
					
					
					







<form id="formRicaricaCarta" method="post" action="/WEBHT/cartaConto/ricaricaCartaDati.do" style="form-horizontal"><div style="display:none"><input type="hidden" name="org.apache.struts.taglib.html.TOKEN" value="da6fe0a2c65f399b924b1fb0b4765f06"></div>
<div class="riquadro clearfix">
	<div class="lg-col-12 clearfix">
		
		
		
		
		




	
	<div class="pager clearfix pull-right">
		<div class="circle_line">&nbsp;</div>
		
			
			
			
				
			
				<div class="circle current_page">&nbsp;</div>
			
		
			
			
			
				<div class="circle ">&nbsp;</div>
			
		
			
			
			
				<div class="circle ">&nbsp;</div>
			
		
			
			
			
				<div class="circle ">&nbsp;</div>
			
		
	</div>






<div class="clearfix">
	
		
		
				



<style>
.imgSrv{
	float: none;
}
</style>


	<h1>
		
				
				<div class="hidden-print hidden-xxs flag ricaricaCarta">&nbsp;</div>
			
			
		
		
			
		
		
			
		
			
				
 					<span>Ricarica carta</span>
 					
				
				
				
				
					
				
			
			
			
		
	</h1>
	
	


		
	
	
	
		
		
			<div class="col-xs-12 hidden-xs hidden-print">
				









			</div>
		
	
</div>
	</div>
	
	








	


	<div class="section clearfix">
		<h3 class="titleSection">
			
			








		
			Seleziona carta da ricaricare
		
		
		
		


		</h3>
		
		<div class="ripetiMobile pull-right isMobile visible-xs" role="button" onclick="mostraNuovaRicarica(false)">Ripeti</div>
		
		<div class="selezioneCC"> 
			
			
			<div id="div_wrapper" class="table-responsive">
				<table class="table table-striped" id="ricaricaCarteConto" role="grid">
					<tbody>
						
						<tr>
   					  		<td class="oCenter hidden-xs">
								<input type="radio" name="codCarta" value="001|0898|089800911819" checked="checked" onclick="altraCarta(false);" id="089800911819">
							</td>
						    <td>
						      	
									
										YouCard
									
									
									
								 
						    </td>
       						<td>*0000</td> 
       						<td class="hidden-xs">
       							MILANO &nbsp;-&nbsp; 
								
									
										2070
									
									
								 
							</td>
       						<td>COGNOME NOME</td>	 
   							
							        	
							<td class="oRight ">
								
									
									
										7,00
									
								 
							</td>
						</tr>	
						<tr>
   					  		<td class="oCenter hidden-xs">
								<input type="radio" name="codCarta" value="001|0898|089800911819" checked="checked" onclick="altraCarta(false);" id="089800911819">
							</td>
						    <td>
						      	
									
										YouCard2
									
									
									
								 
						    </td>
       						<td>*0000</td> 
       						<td class="hidden-xs">
       							MILANO &nbsp;-&nbsp; 
								
									
										2070
									
									
								 
							</td>
       						<td>COGNOME NOME</td>	 
   							
							        	
							<td class="oRight ">
								
									
									
										7,00
									
								 
							</td>
						</tr>	
						<tr id="altraCarta">
							
								
									<td class="oCenter hidden-xs">
										<input type="radio" name="codCarta" value="000000000000" onclick="altraCarta(true);" id="radioAltraCarta">
									</td>
									<td colspan="5">
										Voglio ricaricare un'altra carta <span class="hidden-xs">(emessa dal BANCO BPM)</span> 
									</td>
								
								
							 
						</tr>
					</tbody>
					<thead>
						<tr class="hover">
							<th>&nbsp;</th>
							<th>Tipo carta </th>
							<th>Numero </th>
							<th class="hidden-xs">Filiale </th>
							<th>Intestazione</th>
							<th class="oRight">Saldo residuo </th>
						</tr>
					</thead>
				</table>
			</div>
		
		</div>
		<div class="form-horizontal&quot;">
			<div class="form-group auto">
				
				        	
				<div id="divAltraCarta" style="display: none;">
					
					<div class="form-field-input col-sm-4 col-xs-12">
						<label for="codiceFreccia1" class="control-label">
							Seleziona carta 
						</label>
						<div class="form-field margin-bottom10">
							<div class="col-xs-12">
								<select id="selezioneBeneficiario" class="form-control " style="display: none;">
									<option id="nuovoBen" value="seleziona... ">seleziona... </option>
									
								</select>
								
							</div>
							<div class="col-xs-12 margin-top10 margin-bottom10">	
								<input type="button" name="" value="gestione beneficiari" onclick="document.location.href = getPathContext() + '/pagamenti/listaBeneficiari.do';" class="btn">
							</div>
						</div>
					</div>
					<div class="form-field-input col-sm-4 col-xs-12">
						<label for="codiceFreccia1" class="control-label"> 
							Numero carta da ricaricare 
						</label>
						<div class="form-field">
							<input type="text" name="beneficiarioCarta" value="" readonly="readonly" id="beneficiarioCarta" class="beneficiarioCarta form-control">
						</div>
					</div>
					<div class="form-field-input col-sm-4 col-xs-12 margin-bottom-xs-10">
						<label for="codiceFreccia1" class="control-label"> 
							Seleziona il tipo della carta 
						</label>
						<div class="form-field">
							<select name="beneficiarioTipologia"  id="beneficiarioTipologia" class="form-control left"><option value="">Seleziona</option>
<option value="KALI">Kalibra</option>
<option value="K2">K2</option>
<option value="K3PP">YouCard</option>
<option value="YOUP2P">Chat&amp;Cash</option>
<option value="NOVALUE"></option></select>
							<input type="hidden" name="beneficiarioTipologia" value="" id="beneficiarioHidden">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div class="pull-right margin-bottom20">
	
	<input type="submit" name="ricaricaDati" value="Avanti" class="btn  btn-primary" alt="Avanti">
</div>
</form>

<script type="text/javascript">

function mostraNuovaRicarica(valore){
		if(isMobile()){
			if(valore){
				$('.ripetiPagamento').hide();
				$('#mainNuovaRicarica').show();
			}else{
				$('.ripetiPagamento').show();
				$('#mainNuovaRicarica').hide();
			}
		}
	}




$(document).ready(function(){


	if (!isMobile()) $("#selezioneBeneficiario").combobox();
	if (!isMobile()) { 
			$('.ripetiPagamento').hide();
			$('#mainNuovaRicarica').show();
		if($('#radioAltraCarta').is(':checked')) {
			$('#divAltraCarta').css('display', '');
		}
	}
	
	if (isMobile()) {
		responsiveTable("#ricaricaCarteConto"); // inizializza tabella responsive

		// inizializza selezione righe
		$('#ricaricaCarteConto tr input[type=radio]:checked').each(function() {
			var theRow = $(this).closest('tr');
			$(theRow).addClass('cartaSelezionata');
			if($(theRow).attr('id') == 'altraCarta') {
	    		$('#divAltraCarta').css('display', '');
				cambiaBeneficiario();
	    	}
		});

		$( "#selezioneBeneficiario" ).change(function() {
  			cambiaBeneficiario();
		});
		
 		// evento click su tr
 		$('#ricaricaCarteConto tr').click(function() {
	    	$('#divAltraCarta').hide();
			$('.cartaSelezionata').removeClass('cartaSelezionata');
			$(this).addClass('cartaSelezionata');
	    	$(this).find('input[type=radio]').prop('checked', true);
	    	if ($(this).attr('id') == 'altraCarta') {
	    		$('#divAltraCarta').css('display', '');
				$("#selezioneBeneficiario option:first").attr('selected','selected');
				cambiaBeneficiario();
	    	}
	    });
	}
	
	
	

});

function altraCarta(active) {
	if (active == true) {
		$('#divAltraCarta').css('display', '');
		$("#selezioneBeneficiario option:first").attr('selected','selected');
		cambiaBeneficiario(); 
	} else { 
		$('#divAltraCarta').hide(); 
	}
}

 function cambiaBeneficiario() {
	if ($('#selezioneBeneficiario').find("option:selected").attr("id")=="nuovoBen") {
		$('#beneficiarioCarta').val('');
		$('#beneficiarioTipologia').val('');
		$('#beneficiarioHidden').val('');
	} else {
		var value = $('#selezioneBeneficiario').val();
		var substr = value.split('-');
		$('#beneficiarioCarta').val(substr[0]);
		$('#beneficiarioTipologia').val(substr[1]);
		$('#beneficiarioHidden').val(substr[1]);
	}
}
</script>

<script type="text/javascript">
oldValue = "";
$(function( $, undefined ) {
	$.widget( "ui.combobox", {
		version: "@VERSION",
		widgetEventPrefix: "combobox",
		uiCombo: null,
		uiInput: null,
		_wasOpen: false,
		_create: function() {
			var self = this,
			select = this.element.hide(),
			input, wrapper;

			input = this.uiInput = $( "<input />" ).insertAfter(select)
                .addClass("ui-widget ui-widget-content ui-combobox-input form-control")
                .val(select.children(':selected').text())
                .attr('tabindex', select.attr( 'tabindex'))
                .attr('aria-autocomplete', 'inline')
                .css('width', '82%');
			wrapper = this.uiCombo = input.wrap( '<span>' )
				.parent()
				.addClass( 'ui-combobox' )
				.insertAfter( select );
			input.autocomplete({
				delay: 0,
				minLength: 0,
				appendTo: wrapper,
				source: $.proxy( this, "_linkSelectList" ),
				select: function(event, ui) {
               		$(this).attr('title', ui.item.value);
			 	}
          	});

			input.focusin(function() {
				oldValue = $(this).val();
				$(this).val("");
			});
			input.focusout(function() {
          		$(this).val(oldValue);
          	});

         	$("<button>").attr( "tabIndex", -1 )
            	.attr( "type", "button" )
            	.attr("aria-label", 'Seleziona beneficiario')
            	.insertAfter( input )
            	.button({
               		icons: {
                  		primary: "ui-icon-triangle-1-s"
               		},
					text: false})
				.removeClass("ui-corner-all")
				.addClass("ui-button-icon ui-combobox-button dropdown-arrow");

			// Our items have HTML tags.  The default rendering uses text()
			// to set the content of the <a> tag.  We need html().
			input.data( "ui-autocomplete" )._renderItem = function( ul, item ) {
				 ul.attr('role','listbox')
			 	   .attr('aria-expanded','true');
				
				return $( "<li>" ).attr('class', item.option.className)
					.attr('role', 'option')
					.append( $( "<a>" ).html( item.label ) )
					.appendTo( ul );
			};
			this._on( this._events );
		},

		_linkSelectList: function( request, response ) {
			var matcher = new RegExp( $.ui.autocomplete.escapeRegex(request.term), 'i' );
			response( this.element.children('option:not([style*="display: none"])').map(function() {  
				var text = $( this ).text();
				var value = $(this).attr('value');
				var id = $(this).attr('id');

				if ( this.value && ( !request.term || matcher.test(text) ) ) {
					var optionData = {
					    label: text,
					    value: text,
					    id:id,
					    option: this
					};
					if (request.term) {
						optionData.label = text.replace(
							new RegExp(
							   "(?![^&;]+;)(?!<[^<>]*)(" +
							   $.ui.autocomplete.escapeRegex(request.term) +
							   ")(?![^<>]*>)(?![^&;]+;)", "gi"),
							   "<strong>$1</strong>");
					}
					return optionData;
				}
			}));
		},
		
		_events: {
			"autocompletechange input" : function(event, ui) {
				var $el = $(event.currentTarget);
				var changedOption = ui.item ? ui.item.option : null;
	            if ( !ui.item ) {
	               var matcher = new RegExp( "^" + $.ui.autocomplete.escapeRegex( $el.val() ) + "$", "i" ),
	               valid = false,
	               matchContains = null,
	               iContains = 0,
	               iSelectCtr = -1,
	               iSelected = -1,
	               optContains = null;
	               if (this.options.autofillsinglematch) {
	                  matchContains = new RegExp($.ui.autocomplete.escapeRegex($el.val()), "i");
	               }
	
	               this.element.children( "option" ).each(function() {
	                     var t = $(this).text();
	                     if ( t.match( matcher ) ) {
	                        this.selected = valid = true;
	                        return false;
	                     }
	                     if (matchContains) {
	                        // look for items containing the value
	                        iSelectCtr++;
	                        if (t.match(matchContains)) {
	                           iContains++;
	                           optContains = $(this);
	                           iSelected = iSelectCtr;
	                        }
	                     }
	                });
	
	                if ( !valid ) {
	                   // autofill option:  if there is just one match, then select the matched option
	                   if (iContains == 1) {
	                      changedOption = optContains[0];
	                      changedOption.selected = true;
	                      var t2 = optContains.text();
	                      $el.val(t2);
	                      $el.data('ui-autocomplete').term = t2;
	                      this.element.prop('selectedIndex', iSelected);
	                     
	                   } else {
	                      // remove invalid value, as it didn't match anything
	                      $el.val( '' );
	                      // Internally, term must change before another search is performed
	                      // if the same search is performed again, the menu won't be shown
	                      // because the value didn't actually change via a keyboard event
	                      $el.data( 'ui-autocomplete' ).term = '';
	
	                      this.element.prop('selectedIndex', -1);
	                   }
	                }
	            }
	
	            this._trigger( "change", event, {
	                  item: changedOption
	                });
	         },

	         "autocompleteselect input": function( event, ui ) {
	            ui.item.option.selected = true;
				oldValue = $(ui.item.option).text();
				cambiaBeneficiario();
	            this._trigger( "select", event, {
	            	item: ui.item.option
	            });
	         },
	         
	         "autocompleteopen input": function ( event, ui ) {
	            this.uiCombo.children('.ui-autocomplete')
	               .outerWidth(this.uiCombo.outerWidth(true));
	         },
	         
	         "mousedown .ui-combobox-button" : function ( event ) {
	            this._wasOpen = this.uiInput.autocomplete("widget").is(":visible");
	         },
	         
			 // click sul triangolo che apre la combobox 
	         "click .ui-combobox-button" : function( event ) {
	            this.uiInput.focus();
	            // close if already visible
	            if (this._wasOpen)
	               return;
	            // pass empty string as value to search for, displaying all results
	            this.uiInput.autocomplete("search", "");
	         }
		},
      
		value: function ( newVal ) {
			var select = this.element,
				valid = false,
				selected;
	
			if ( !arguments.length ) {
				selected = select.children( ":selected" );
				return selected.length > 0 ? selected.val() : null;
			}
			
			select.prop('selectedIndex', -1);
			select.children('option').each(function() {
				if ( this.value == newVal ) {
					this.selected = valid = true;
					return false;
				}
			});
			
			if ( valid ) {
				this.uiInput.val(select.children(':selected').text());
				this.uiInput.attr('title', select.children(':selected').text())
			} else {
				this.uiInput.val( "" );
				this.element.prop('selectedIndex', -1);
			}
		},
		_destroy: function () {
			this.element.show();
			this.uiCombo.replaceWith( this.element );
		},
		widget: function () {
			return this.uiCombo;
		},
		_getCreateEventData: function() {
			return {
				select: this.element,
				combo: this.uiCombo,
				input: this.uiInput
			};
		}
	});
    //$("#selezioneBeneficiario").combobox();
}(jQuery));


</script>